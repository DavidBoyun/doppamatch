<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ÎèÑÌååÎß§Ïπò - DoppaMatch</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        /*
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * ÎèÑÌååÎß§Ïπò (DoppaMatch) v7.0
         * Ïπ¥ÏßÄÎÖ∏ Ïã¨Î¶¨Ìïô Í∏∞Î∞ò Ï§ëÎèÖ Î©îÏª§ÎãàÏ¶ò
         * 
         * ÌïµÏã¨ ÏõêÎ¶¨:
         * 1. ÏÜêÏã§ ÌöåÌîº (Loss Aversion) - ÏûÉÎäî Í≤ÉÏù¥ 2.5Î∞∞ Îçî ÏïÑÌîÑÎã§
         * 2. Í∞ÄÎ≥Ä Î≥¥ÏÉÅ (Variable Ratio) - ÏòàÏ∏° Î∂àÍ∞ÄÎä•Ìïú Î≥¥ÏÉÅÏù¥ ÎèÑÌååÎØº 400% Ï¶ùÍ∞Ä
         * 3. Near Miss Ìö®Í≥º - "Í±∞Ïùò ÏÑ±Í≥µ"Ïù¥ Ïã§Ï†ú ÏÑ±Í≥µÎ≥¥Îã§ Îçî Ï§ëÎèÖÏ†Å
         * 4. ÏóêÏä§Ïª¨Î†àÏù¥ÌåÖ Í∏¥Ïû• - Ï†êÏ†ê Í∞ïÌï¥ÏßÄÎäî ÏïïÎ∞ïÍ∞ê
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         */
        
        :root { 
            --gold: #ffd700; 
            --accent: #ff6b35; 
            --bg: #0a0a12; 
            --card: #1a1a2e; 
            --success: #00c853;
            --danger: #ff3b30;
            --heartbeat: 1s;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background: var(--bg); 
            min-height: 100vh; 
            color: #fff; 
            overflow: hidden;
            transition: filter 0.3s, background 0.3s;
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * üé® v7.2: ÏãúÍ∞ÑÏóê Îî∞Î•∏ Î∞∞Í≤ΩÏÉâ Î≥ÄÌôî
         * Ïã¨Î¶¨Ìïô: ÌôòÍ≤Ω Ï†ÑÏ≤¥Í∞Ä Î≥ÄÌï¥Ïïº Î≥∏Îä•Ï†ÅÏúºÎ°ú ÏúÑÌóòÏùÑ ÎäêÎÇå
         * Ìà¨Î™Ö ‚Üí Ï¥àÎ°ù ‚Üí ÎÖ∏Îûë ‚Üí Ï£ºÌô© ‚Üí Îπ®Í∞ï
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .time-atmosphere {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s, background 0.5s;
        }
        .time-atmosphere.safe {
            opacity: 0;
        }
        .time-atmosphere.caution {
            opacity: 0.15;
            background: radial-gradient(ellipse at center, rgba(0,255,100,0.3) 0%, transparent 70%);
        }
        .time-atmosphere.warning {
            opacity: 0.25;
            background: radial-gradient(ellipse at center, rgba(255,255,0,0.4) 0%, transparent 70%);
        }
        .time-atmosphere.danger {
            opacity: 0.35;
            background: radial-gradient(ellipse at center, rgba(255,150,0,0.5) 0%, transparent 70%);
        }
        .time-atmosphere.critical {
            opacity: 0.5;
            background: radial-gradient(ellipse at center, rgba(255,50,0,0.6) 0%, rgba(100,0,0,0.3) 70%);
            animation: atmospherePulse 0.5s infinite;
        }
        @keyframes atmospherePulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.6; }
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * üåü v7.2: ÌîºÎ≤Ñ ÏóêÎÑàÏßÄ ÎÇ†ÏïÑÍ∞ÄÎäî Ìö®Í≥º
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .fever-energy {
            position: fixed;
            font-size: 16px;
            pointer-events: none;
            z-index: 500;
            animation: feverEnergyFly 0.6s ease-out forwards;
        }
        @keyframes feverEnergyFly {
            0% { 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(0.5);
            }
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * üéâ v7.2: ÌîºÎ≤ÑÌÉÄÏûÑ ÎÇòÏù¥Ìä∏ÌÅ¥ÎüΩ Ìö®Í≥º
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .fever-nightclub {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 798;
            display: none;
            overflow: hidden;
        }
        .fever-nightclub.on {
            display: block;
            animation: nightclubPulse 0.3s infinite alternate;
        }
        @keyframes nightclubPulse {
            0% { background: rgba(255,0,128,0.1); }
            33% { background: rgba(0,255,255,0.1); }
            66% { background: rgba(255,215,0,0.1); }
            100% { background: rgba(128,0,255,0.1); }
        }
        
        .star-rain {
            position: absolute;
            font-size: 20px;
            animation: starFall linear forwards;
            opacity: 0.8;
        }
        @keyframes starFall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        /* ÌîºÎ≤Ñ Î¨¥Ï†Å ÌëúÏãú */
        .fever-invincible {
            position: fixed;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff0080, #7c3aed);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 800;
            color: #fff;
            z-index: 200;
            display: none;
            animation: invinciblePulse 0.5s infinite alternate;
        }
        .fever-invincible.on { display: block; }
        @keyframes invinciblePulse {
            from { box-shadow: 0 0 20px rgba(255,0,128,0.5); transform: translateX(-50%) scale(1); }
            to { box-shadow: 0 0 40px rgba(255,0,128,0.8); transform: translateX(-50%) scale(1.05); }
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * üî¥ ÏúÑÌóò Î™®Îìú (DANGER MODE) - 5Ï¥à Ïù¥Ìïò
         * Ïã¨Î¶¨Ìïô: ÏãúÍ∞Ñ ÏïïÎ∞ïÏùÄ ÌåêÎã®Î†•ÏùÑ ÌùêÎ¶¨Í≤å ÌïòÍ≥† Ï∂©ÎèôÏ†Å ÌñâÎèôÏùÑ Ïú†Î∞ú
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        
        /* ÎπÑÎÑ§ÌåÖ Ïò§Î≤ÑÎ†àÏù¥ */
        .danger-vignette {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 800;
            opacity: 0;
            transition: opacity 0.3s;
            background: radial-gradient(ellipse at center, 
                transparent 0%, 
                transparent 40%, 
                rgba(255,0,0,0.3) 70%, 
                rgba(139,0,0,0.6) 100%
            );
        }
        .danger-vignette.on { opacity: 1; }
        .danger-vignette.critical { 
            opacity: 1;
            animation: vignettePulse 0.5s infinite;
            background: radial-gradient(ellipse at center, 
                transparent 0%, 
                transparent 30%, 
                rgba(255,0,0,0.5) 60%, 
                rgba(139,0,0,0.8) 100%
            );
        }
        @keyframes vignettePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        /* Ï†ÑÏ≤¥ ÌôîÎ©¥ Î∂âÏùÄ ÌÜ§ */
        body.danger-mode {
            animation: bodyDanger 1s infinite;
        }
        body.critical-mode {
            animation: bodyCritical 0.4s infinite;
        }
        @keyframes bodyDanger {
            0%, 100% { filter: hue-rotate(0deg) saturate(1); }
            50% { filter: hue-rotate(-10deg) saturate(1.2); }
        }
        @keyframes bodyCritical {
            0%, 100% { filter: hue-rotate(-15deg) saturate(1.5) brightness(0.9); }
            50% { filter: hue-rotate(-25deg) saturate(1.8) brightness(1.1); }
        }
        
        /* Ïã¨Ïû•Î∞ïÎèô Ïò§Î≤ÑÎ†àÏù¥ */
        .heartbeat-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 799;
            background: transparent;
            display: none;
        }
        .heartbeat-overlay.on {
            display: block;
            animation: heartbeatFlash var(--heartbeat) infinite;
        }
        @keyframes heartbeatFlash {
            0%, 100% { background: transparent; }
            10% { background: rgba(255,0,0,0.15); }
            20% { background: transparent; }
            30% { background: rgba(255,0,0,0.1); }
            40% { background: transparent; }
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * üíî ÏΩ§Î≥¥ ÎÅäÍπÄ Ïù¥ÌéôÌä∏
         * Ïã¨Î¶¨Ìïô: Ï∂ïÏ†ÅÎêú Í≤ÉÏùÑ ÏûÉÎäî ÏïÑÌîî > Ï≤òÏùåÎ∂ÄÌÑ∞ ÏóÜÎäî Í≤É
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .combo-break-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 850;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }
        .combo-break-overlay.show {
            animation: comboBreakAnim 1s ease forwards;
        }
        @keyframes comboBreakAnim {
            0% { opacity: 0; }
            10% { opacity: 1; background: rgba(255,0,0,0.3); }
            30% { opacity: 1; }
            100% { opacity: 0; background: transparent; }
        }
        .combo-break-text {
            font-size: 48px;
            font-weight: 900;
            color: #ff3b30;
            text-shadow: 0 0 30px rgba(255,0,0,0.8);
            animation: comboBreakTextAnim 1s ease;
        }
        @keyframes comboBreakTextAnim {
            0% { transform: scale(0.5); opacity: 0; }
            20% { transform: scale(1.3); opacity: 1; }
            40% { transform: scale(1); }
            100% { transform: scale(0.8) translateY(-50px); opacity: 0; }
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * ‚è∞ ÏãúÍ∞Ñ Ï∞®Í∞ê Ïù¥ÌéôÌä∏
         * Ïã¨Î¶¨Ìïô: ÏÜêÏã§ÏùÑ ÏãúÍ∞ÅÏ†ÅÏúºÎ°ú Î™ÖÌôïÌûà Î≥¥Ïó¨Ï§òÏïº ÏïÑÌîîÏù¥ Í∑πÎåÄÌôî
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .time-penalty {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 64px;
            font-weight: 900;
            color: #ff3b30;
            text-shadow: 0 0 20px rgba(255,0,0,0.8);
            pointer-events: none;
            z-index: 860;
            opacity: 0;
        }
        .time-penalty.show {
            animation: timePenaltyAnim 0.8s ease forwards;
        }
        @keyframes timePenaltyAnim {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -80%) scale(0.8); }
        }
        
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * üé∞ Îü≠ÌÇ§ ÌÉÄÏûÑ Ïù¥ÌéôÌä∏
         * Ïã¨Î¶¨Ìïô: ÏòàÏÉÅÏπò Î™ªÌïú Î≥¥ÎÑàÏä§ = ÎèÑÌååÎØº Ìè≠Î∞ú
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .lucky-time-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd700, #ff6b35);
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 900;
            color: #000;
            text-align: center;
            z-index: 900;
            display: none;
            box-shadow: 0 0 50px rgba(255,215,0,0.8);
            animation: luckyBannerPulse 0.5s infinite alternate;
        }
        .lucky-time-banner.show { display: block; }
        @keyframes luckyBannerPulse {
            from { transform: translate(-50%, -50%) scale(1); }
            to { transform: translate(-50%, -50%) scale(1.05); }
        }
        
        .lucky-indicator {
            position: fixed;
            top: 60px;
            right: 10px;
            background: linear-gradient(135deg, #ffd700, #ff6b35);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 800;
            color: #000;
            z-index: 150;
            display: none;
            animation: luckyIndicatorPulse 1s infinite;
        }
        .lucky-indicator.on { display: flex; align-items: center; gap: 5px; }
        @keyframes luckyIndicatorPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255,215,0,0.5); }
            50% { box-shadow: 0 0 25px rgba(255,215,0,0.9); }
        }
        
        /* Ïù¥ÌéôÌä∏ Î†àÏù¥Ïñ¥ */
        #fx { position: fixed; inset: 0; pointer-events: none; z-index: 900; overflow: hidden; }
        .particle { 
            position: absolute; 
            animation: pfly 0.7s cubic-bezier(0,.9,.4,1) forwards;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }
        @keyframes pfly { 
            0% { transform: translate(-50%,-50%) scale(1); opacity: 1; } 
            100% { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; } 
        }
        
        /* ÌôîÎ©¥ ÌùîÎì§Î¶º */
        .shake { animation: shake 0.4s ease; }
        .shake-hard { animation: shakeHard 0.5s ease; }
        .shake-damage { animation: shakeDamage 0.3s ease; }
        @keyframes shake { 
            0%,100% { transform: translateX(0); } 
            25% { transform: translateX(-3px); } 
            75% { transform: translateX(3px); } 
        }
        @keyframes shakeHard { 
            0%,100% { transform: translate(0); } 
            20% { transform: translate(-5px,-2px); } 
            40% { transform: translate(5px,2px); } 
            60% { transform: translate(-3px,1px); } 
            80% { transform: translate(3px,-1px); } 
        }
        @keyframes shakeDamage {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-8px); }
            30% { transform: translateX(8px); }
            50% { transform: translateX(-6px); }
            70% { transform: translateX(6px); }
            90% { transform: translateX(-3px); }
        }
        
        /* Ïã§ÏãúÍ∞Ñ ÌîºÎìú */
        .feed { 
            position: fixed; top: 0; left: 0; width: 100%; height: 26px; 
            background: rgba(0,0,0,0.9); 
            border-bottom: 1px solid rgba(255,215,0,0.15); 
            overflow: hidden; z-index: 100; 
            display: flex; align-items: center; 
        }
        .feed-inner { 
            display: flex; gap: 50px; 
            animation: feedMove 25s linear infinite; 
            white-space: nowrap; padding-left: 100%; 
        }
        .feed-item { font-size: 11px; color: #888; display: flex; align-items: center; gap: 6px; }
        .feed-item b { color: var(--gold); font-weight: 600; }
        .feed-dot { width: 5px; height: 5px; background: #00ff88; border-radius: 50%; animation: pulse 1s infinite; }
        @keyframes feedMove { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        /* Ìó§Îçî */
        .header { 
            padding: 10px 16px; padding-top: 36px; 
            display: flex; justify-content: space-between; align-items: center; 
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%); 
        }
        .stat { 
            background: rgba(255,255,255,0.08); 
            padding: 6px 14px; border-radius: 20px; 
            font-size: 13px; font-weight: 700; 
            display: flex; align-items: center; gap: 5px; 
        }
        .stat.gold { color: var(--gold); border: 1px solid rgba(255,215,0,0.2); }
        
        /* ÌîºÎ≤ÑÎ∞î */
        .fever-wrap { 
            position: fixed; top: 26px; left: 0; width: 100%; height: 8px; 
            background: rgba(255,255,255,0.1); z-index: 99; 
        }
        .fever-bar { 
            height: 100%; width: 0%; 
            background: linear-gradient(90deg, #ff0080, var(--gold)); 
            transition: width 0.2s; 
        }
        .fever-bar.active { animation: feverGlow 0.3s infinite alternate; }
        @keyframes feverGlow { to { filter: brightness(1.5); box-shadow: 0 0 15px var(--gold); } }
        
        .fever-label {
            position: fixed; top: 26px; right: 10px; 
            font-size: 10px; font-weight: 700; color: #ff0080;
            z-index: 100; line-height: 8px;
        }
        
        .fever-mode { 
            position: fixed; top: 40px; left: 50%; transform: translateX(-50%); 
            font-size: 14px; font-weight: 800; color: var(--gold); 
            text-shadow: 0 0 10px var(--gold); z-index: 101; 
            display: none; animation: feverText 0.3s infinite alternate; 
        }
        .fever-mode.on { display: block; }
        @keyframes feverText { to { transform: translateX(-50%) scale(1.05); } }
        
        /* Í≤åÏûÑ ÏòÅÏó≠ */
        .game { 
            padding: 10px; display: flex; flex-direction: column; align-items: center; 
            min-height: calc(100vh - 80px); 
        }
        
        /* Î©îÍ∞Ä ÌÉÄÏù¥Î®∏ - ÏúÑÌóòÌï† Îïå Îçî Í∑πÏ†ÅÏúºÎ°ú */
        .mega-timer {
            width: 90px; height: 90px;
            border-radius: 50%;
            background: radial-gradient(circle, #1a1a2e 0%, #0a0a12 100%);
            border: 4px solid var(--gold);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            margin-bottom: 10px;
            position: relative;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(255,215,0,0.2);
        }
        .mega-timer.warning {
            border-color: #ff9900;
            border-width: 5px;
            animation: timerWarning 0.8s infinite;
            box-shadow: 0 0 30px rgba(255,153,0,0.5);
            transform: scale(1.05);
        }
        @keyframes timerWarning {
            0%, 100% { box-shadow: 0 0 30px rgba(255,153,0,0.5); }
            50% { box-shadow: 0 0 50px rgba(255,153,0,0.8); }
        }
        .mega-timer.danger {
            border-color: var(--danger);
            border-width: 6px;
            animation: timerDanger 0.4s infinite;
            box-shadow: 0 0 50px rgba(255,0,0,0.7);
            transform: scale(1.1);
        }
        @keyframes timerDanger {
            0%, 100% { 
                transform: scale(1.1) rotate(0deg); 
                box-shadow: 0 0 50px rgba(255,0,0,0.7);
            }
            25% { transform: scale(1.15) rotate(-3deg); }
            50% { 
                transform: scale(1.1) rotate(0deg);
                box-shadow: 0 0 70px rgba(255,0,0,1);
            }
            75% { transform: scale(1.15) rotate(3deg); }
        }
        .mega-timer.critical {
            border-color: #ff0000;
            border-width: 8px;
            animation: timerCritical 0.2s infinite;
            box-shadow: 0 0 80px rgba(255,0,0,1), inset 0 0 30px rgba(255,0,0,0.5);
            transform: scale(1.2);
        }
        @keyframes timerCritical { 
            0%, 100% { transform: scale(1.2) rotate(-5deg); } 
            50% { transform: scale(1.25) rotate(5deg); }
        }
        .mega-timer.frozen {
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0,255,255,0.5);
        }
        
        /* v7.3: ÌîÑÎ¶¨Ï¶à ÌååÎûÄÏÉâ Ï†ÑÏ≤¥ ÌôîÎ©¥ */
        .freeze-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 799;
            background: radial-gradient(ellipse at center, rgba(0,255,255,0.2) 0%, rgba(0,100,200,0.3) 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .freeze-overlay.on {
            opacity: 1;
            animation: freezePulse 0.5s infinite alternate;
        }
        @keyframes freezePulse {
            from { background: radial-gradient(ellipse at center, rgba(0,255,255,0.2) 0%, rgba(0,100,200,0.3) 70%); }
            to { background: radial-gradient(ellipse at center, rgba(0,255,255,0.35) 0%, rgba(0,150,255,0.4) 70%); }
        }
        
        /* v7.3: ÏïÑÏù¥ÌÖú ÌûåÌä∏ ÎßêÌíçÏÑ† */
        .item-hint {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--gold), var(--accent));
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            z-index: 200;
            display: none;
            animation: hintBounce 0.5s infinite;
            white-space: nowrap;
        }
        .item-hint.on { display: block; }
        .item-hint::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--accent);
        }
        @keyframes hintBounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }
        
        .timer-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--gold);
            font-family: 'Pretendard', monospace;
            transition: color 0.2s;
        }
        .mega-timer.danger .timer-value,
        .mega-timer.critical .timer-value {
            color: var(--danger);
            animation: timerBlink 0.25s infinite;
        }
        .timer-ms {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            font-family: 'Pretendard', monospace;
        }
        .mega-timer.danger .timer-ms,
        .mega-timer.critical .timer-ms {
            color: var(--danger);
        }
        @keyframes timerBlink { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        .tick-indicator {
            position: absolute;
            top: -8px; right: -8px;
            font-size: 16px;
            animation: tickBounce 0.5s ease;
            display: none;
        }
        .tick-indicator.show { display: block; }
        @keyframes tickBounce { 
            0% { transform: scale(0); } 
            50% { transform: scale(1.3); } 
            100% { transform: scale(1); } 
        }
        
        /* Ïó∞ÏÜç Ïã§Ïàò Ïπ¥Ïö¥ÌÑ∞ */
        .mistake-counter {
            position: fixed;
            top: 135px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #ff6666;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 150;
        }
        .mistake-counter.show { opacity: 1; }
        
        /* ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§ ÌëúÏãú */
        .combo-bonus {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            font-size: 14px;
            font-weight: 800;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: right;
        }
        .combo-bonus.show { opacity: 1; }
        .combo-bonus-value {
            font-size: 20px;
            display: block;
            animation: comboBonusPulse 0.5s infinite alternate;
        }
        @keyframes comboBonusPulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        /* ÏΩ§Î≥¥ */
        .combo { height: 40px; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px; }
        .combo-text { 
            font-size: 24px; font-weight: 900; color: var(--accent); 
            opacity: 0; transition: all 0.15s;
            text-shadow: 0 0 10px rgba(255,107,53,0.5);
        }
        .combo-text.show { opacity: 1; transform: scale(1.1); }
        .combo-text.high { 
            color: #ff00ff;
            text-shadow: 0 0 20px rgba(255,0,255,0.8);
            animation: comboHighPulse 0.3s infinite alternate;
        }
        @keyframes comboHighPulse {
            from { transform: scale(1.1); }
            to { transform: scale(1.2); }
        }
        .combo-mult { font-size: 12px; color: #888; }
        .combo-fire { 
            font-size: 16px; 
            display: none;
            animation: fireFlicker 0.2s infinite alternate;
        }
        .combo-fire.show { display: inline; }
        @keyframes fireFlicker {
            from { opacity: 0.8; transform: scale(1); }
            to { opacity: 1; transform: scale(1.1); }
        }
        
        /* Î†àÎ≤® */
        .level-box { 
            background: rgba(255,255,255,0.05); 
            padding: 8px 20px; border-radius: 10px; 
            margin-bottom: 10px; text-align: center; 
        }
        .level-text { font-size: 15px; font-weight: 800; color: var(--gold); }
        .level-sub { font-size: 10px; color: #666; margin-top: 2px; }
        
        /* Ïπ¥Îìú Í∑∏Î¶¨Îìú */
        .grid { display: grid; gap: 6px; margin: 10px 0; }
        .card { 
            width: 56px; height: 56px; 
            position: relative; cursor: pointer; 
            transform-style: preserve-3d; 
            transition: transform 0.25s ease;
            border-radius: 10px; 
        }
        @media (max-width: 360px) { .card { width: 48px; height: 48px; } }
        
        .card.flipped { transform: rotateY(180deg); }
        .card.matched { 
            transform: rotateY(180deg); 
            animation: matchPop 0.3s ease;
        }
        @keyframes matchPop { 
            0% { transform: rotateY(180deg) scale(1); } 
            50% { transform: rotateY(180deg) scale(1.15); } 
            100% { transform: rotateY(180deg) scale(1); } 
        }
        
        .card.wrong { animation: cardWrong 0.4s ease; }
        @keyframes cardWrong { 
            0%,100% { transform: rotateY(180deg) translateX(0); box-shadow: none; } 
            10% { transform: rotateY(180deg) translateX(-8px); box-shadow: 0 0 20px rgba(255,0,0,0.5); }
            30% { transform: rotateY(180deg) translateX(8px); }
            50% { transform: rotateY(180deg) translateX(-6px); }
            70% { transform: rotateY(180deg) translateX(6px); }
            90% { transform: rotateY(180deg) translateX(-3px); }
        }
        
        .card.hint { animation: hintGlow 0.5s ease infinite; }
        @keyframes hintGlow { 
            0%,100% { box-shadow: 0 0 10px var(--gold); } 
            50% { box-shadow: 0 0 25px var(--gold); } 
        }
        
        .face { 
            position: absolute; inset: 0; 
            backface-visibility: hidden; 
            border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; 
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }
        .face.front { 
            background: linear-gradient(145deg, #1e1e32, #12121f); 
            border: 2px solid rgba(255,215,0,0.15); 
            transform: rotateY(180deg); 
            font-size: 26px; 
        }
        .face.back { 
            background: linear-gradient(145deg, #2d2d4a, #1e1e32); 
            border: 2px solid rgba(255,255,255,0.08); 
            font-size: 18px; color: rgba(255,255,255,0.15); font-weight: 700; 
        }
        .card.matched .face.front { 
            background: linear-gradient(145deg, #0d2d0d, #061f06); 
            border-color: var(--success); 
        }
        
        /* ÏÖîÌîå Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .card.shuffle-center { animation: shuffleCenter 0.2s ease forwards; }
        @keyframes shuffleCenter { to { transform: translate(var(--toX), var(--toY)) scale(0.5); } }
        
        .card.shuffle-spin { animation: shuffleSpin 0.3s ease forwards; }
        @keyframes shuffleSpin {
            0% { transform: translate(var(--toX), var(--toY)) scale(0.5) rotateZ(0deg); }
            50% { transform: translate(var(--toX), var(--toY)) scale(0.6) rotateZ(180deg); }
            100% { transform: translate(var(--toX), var(--toY)) scale(0.5) rotateZ(360deg); }
        }
        
        .card.shuffle-spread { animation: shuffleSpread 0.2s ease forwards; }
        @keyframes shuffleSpread {
            from { transform: translate(var(--toX), var(--toY)) scale(0.5); }
            to { transform: translate(0, 0) scale(1); }
        }
        
        /* GO! ÌÖçÏä§Ìä∏ */
        .go-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 5em;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 
                0 0 20px rgba(255,215,0,0.8),
                0 0 40px rgba(255,107,53,0.6),
                4px 4px 0 rgba(0,0,0,0.3);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
        }
        .go-text.show { animation: goTextPop 0.8s ease-out forwards; }
        @keyframes goTextPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            40% { transform: translate(-50%, -50%) scale(1.4); opacity: 1; }
            70% { transform: translate(-50%, -70%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -90%) scale(0.8); opacity: 0; }
        }
        
        /* ÏïÑÏù¥ÌÖú Î∞î */
        .items { 
            position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); 
            display: flex; gap: 10px; padding: 10px 18px; 
            background: rgba(0,0,0,0.85); border-radius: 28px; 
            border: 1px solid rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px); z-index: 50; 
        }
        .item { 
            width: 46px; height: 46px; border-radius: 50%; border: none; 
            background: rgba(255,255,255,0.08); 
            font-size: 20px; position: relative; cursor: pointer; 
            transition: all 0.2s; 
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }
        .item:active:not(:disabled) { transform: scale(0.9); }
        .item:disabled { opacity: 0.25; cursor: not-allowed; }
        .item-cnt { 
            position: absolute; top: -4px; right: -4px; 
            background: var(--accent); color: #fff; 
            font-size: 9px; font-weight: 700; 
            width: 16px; height: 16px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-family: 'Pretendard', sans-serif;
        }
        
        /* Î±ÉÏßÄ Î≤ÑÌäº */
        .badge-btn { 
            position: fixed; bottom: 80px; right: 12px; 
            width: 44px; height: 44px; 
            background: linear-gradient(135deg, #7c3aed, #ec4899); 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 18px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(124,58,237,0.4); z-index: 50; 
        }
        .badge-cnt { 
            position: absolute; top: -2px; right: -2px; 
            background: var(--gold); color: #000; 
            font-size: 9px; font-weight: 700; 
            padding: 2px 5px; border-radius: 8px; 
            font-family: 'Pretendard', sans-serif;
        }
        
        /* Ïò§Î≤ÑÎ†àÏù¥ */
        .overlay { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.92); z-index: 500; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px; opacity: 0; pointer-events: none; 
            transition: opacity 0.25s; backdrop-filter: blur(8px); 
        }
        .overlay.on { opacity: 1; pointer-events: auto; }
        
        .popup { 
            background: linear-gradient(145deg, #1a1a2e, #0d0d18); 
            border: 1px solid rgba(255,215,0,0.15); 
            border-radius: 20px; padding: 24px; 
            width: 100%; max-width: 340px; max-height: 80vh; overflow-y: auto; 
            position: relative;
        }
        .popup-title { font-size: 20px; font-weight: 800; text-align: center; margin-bottom: 16px; color: var(--gold); }
        
        /* ÏãúÏûë ÌôîÎ©¥ - Ïò§ÎäòÏùò Î™©Ìëú Ï∂îÍ∞Ä */
        .start-logo { font-size: 50px; margin-bottom: 8px; }
        .start-title { 
            font-size: 32px; font-weight: 900; 
            background: linear-gradient(135deg, var(--gold), var(--accent)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            background-clip: text; margin-bottom: 4px; 
        }
        .start-sub { font-size: 12px; color: #666; letter-spacing: 3px; margin-bottom: 20px; }
        
        /* Ïò§ÎäòÏùò ÎèÑÏ†Ñ Î∞ïÏä§ */
        .daily-challenge {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,107,53,0.1));
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 15px;
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
            width: 100%;
            max-width: 280px;
        }
        .daily-title {
            font-size: 12px;
            color: var(--gold);
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .daily-goal {
            font-size: 18px;
            font-weight: 800;
            color: #fff;
            margin-bottom: 6px;
        }
        .daily-reward {
            font-size: 13px;
            color: #aaa;
        }
        .daily-reward b {
            color: var(--gold);
        }
        .daily-progress {
            margin-top: 10px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        .daily-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--accent));
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ÏµúÍ≥† Í∏∞Î°ù */
        .best-record {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 12px;
            color: #888;
        }
        .best-record span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .best-record b {
            color: var(--gold);
            font-size: 14px;
        }
        
        .btn-start { 
            background: linear-gradient(135deg, var(--gold), var(--accent)); 
            border: none; padding: 16px 48px; border-radius: 30px; 
            font-size: 18px; font-weight: 800; color: #000; 
            cursor: pointer; font-family: inherit; transition: transform 0.2s; 
        }
        .btn-start:active { transform: scale(0.96); }
        
        .sound-hint {
            position: absolute;
            bottom: 80px;
            font-size: 12px;
            color: #666;
            animation: hintPulse 2s infinite;
        }
        @keyframes hintPulse { 0%,100% { opacity: 0.5; } 50% { opacity: 1; } }
        
        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s;
        }
        .settings-btn:hover { opacity: 1; }
        
        /* ÌçΩ ÏÑ†ÌÉù ÌÉÄÏù¥Î®∏ */
        .perk-timer {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin-top: 12px;
            overflow: hidden;
        }
        .perk-timer-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--accent));
            width: 100%;
            transition: width 0.1s linear;
        }
        .perk-countdown {
            text-align: center;
            font-size: 24px;
            font-weight: 900;
            color: var(--gold);
            margin-top: 8px;
        }
        
        /* ÌçΩ ÏÑ†ÌÉù */
        .perk-list { display: flex; flex-direction: column; gap: 10px; margin-top: 16px; }
        .perk { 
            background: rgba(255,255,255,0.04); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 14px; padding: 16px; 
            cursor: pointer; transition: all 0.2s; text-align: left; 
        }
        .perk:hover { border-color: var(--gold); background: rgba(255,215,0,0.05); }
        .perk:active { transform: scale(0.98); }
        .perk-icon { font-size: 22px; margin-bottom: 6px; }
        .perk-name { font-size: 14px; font-weight: 700; margin-bottom: 2px; }
        .perk-desc { font-size: 11px; color: #888; }
        
        /* Î≥¥ÎÑàÏä§ ÎùºÏö¥Îìú */
        .slot-wrap { display: flex; gap: 8px; justify-content: center; margin: 20px 0; }
        .slot { 
            width: 60px; height: 70px; 
            background: rgba(0,0,0,0.5); 
            border: 2px solid rgba(255,215,0,0.3); 
            border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 32px; 
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }
        .slot.spin { animation: slotSpin 0.08s infinite; }
        @keyframes slotSpin { 0% { transform: translateY(-3px); } 100% { transform: translateY(3px); } }
        .btn-spin { 
            width: 100%; padding: 14px; 
            background: linear-gradient(135deg, var(--gold), var(--accent)); 
            border: none; border-radius: 12px; 
            font-size: 16px; font-weight: 800; color: #000; 
            cursor: pointer; font-family: inherit; margin-top: 10px; 
        }
        .btn-spin:disabled { opacity: 0.5; }
        
        /* Î±ÉÏßÄ Í∑∏Î¶¨Îìú */
        .badge-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 16px; }
        .badge { text-align: center; padding: 10px 4px; background: rgba(255,255,255,0.03); border-radius: 10px; border: 1px solid transparent; }
        .badge.got { border-color: var(--gold); }
        .badge.locked { opacity: 0.3; }
        .badge-icon { font-size: 22px; }
        .badge-name { font-size: 8px; color: #888; margin-top: 4px; }
        
        /* Í≤åÏûÑÏò§Î≤Ñ - Near Miss Í∞ïÏ°∞ */
        .go-title { font-size: 28px; font-weight: 900; color: var(--danger); margin-bottom: 8px; }
        .near-miss {
            background: rgba(255,107,53,0.2);
            border: 1px solid rgba(255,107,53,0.5);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 16px;
            animation: nearMissPulse 1s infinite;
        }
        @keyframes nearMissPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255,107,53,0.3); }
            50% { box-shadow: 0 0 20px rgba(255,107,53,0.6); }
        }
        .near-miss-text {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent);
        }
        .near-miss-detail {
            font-size: 11px;
            color: #aaa;
            margin-top: 4px;
        }
        .go-score { font-size: 36px; font-weight: 800; color: var(--gold); margin-bottom: 4px; }
        .go-stats { display: flex; gap: 16px; margin: 16px 0; justify-content: center; }
        .go-stat { text-align: center; }
        .go-stat-val { font-size: 20px; font-weight: 800; color: var(--gold); }
        .go-stat-lbl { font-size: 10px; color: #666; }
        
        /* Îû≠ÌÇπ ÌëúÏãú */
        .rank-display {
            margin: 12px 0;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            text-align: center;
        }
        .rank-text {
            font-size: 12px;
            color: #888;
        }
        .rank-text b {
            color: var(--gold);
            font-size: 16px;
        }
        
        .btn-revive { 
            width: 100%; padding: 14px; 
            background: linear-gradient(135deg, #00c853, #69f0ae); 
            border: none; border-radius: 12px; 
            font-size: 14px; font-weight: 700; color: #000; 
            cursor: pointer; font-family: inherit; margin-bottom: 10px;
            animation: revivePulse 1s infinite;
        }
        @keyframes revivePulse {
            0%, 100% { box-shadow: 0 0 10px rgba(0,200,83,0.3); }
            50% { box-shadow: 0 0 25px rgba(0,200,83,0.6); }
        }
        .btn-retry { 
            width: 100%; padding: 14px; 
            background: rgba(255,255,255,0.1); 
            border: none; border-radius: 12px; 
            font-size: 14px; font-weight: 600; color: #fff; 
            cursor: pointer; font-family: inherit; 
        }
        .btn-revenge {
            width: 100%; padding: 14px;
            background: linear-gradient(135deg, #ff4444, #ff8800);
            border: none; border-radius: 12px;
            font-size: 16px; font-weight: 800; color: #fff;
            cursor: pointer; font-family: inherit; margin-bottom: 8px;
            animation: revengePulse 0.5s infinite alternate;
        }
        @keyframes revengePulse {
            from { box-shadow: 0 0 10px rgba(255,68,68,0.5); transform: scale(1); }
            to { box-shadow: 0 0 25px rgba(255,136,0,0.8); transform: scale(1.02); }
        }
        .btn-giveup {
            width: 100%; padding: 10px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            font-size: 12px; color: #666;
            cursor: pointer; font-family: inherit;
        }
        .btn-badges {
            width: 100%; padding: 12px;
            background: linear-gradient(135deg, rgba(124,58,237,0.3), rgba(236,72,153,0.3));
            border: 1px solid rgba(124,58,237,0.5);
            border-radius: 10px;
            font-size: 13px; font-weight: 600; color: #fff;
            cursor: pointer; font-family: inherit;
            margin-bottom: 8px;
        }
        
        /* v7.3: Îä•Î†• Î∂ÑÏÑù Î∞ïÏä§ */
        .analysis-box {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: left;
        }
        .analysis-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 10px;
            text-align: center;
        }
        .analysis-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 11px;
        }
        .analysis-row > span:first-child {
            width: 60px;
            color: #888;
        }
        .analysis-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        .analysis-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--accent));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .analysis-pct {
            width: 55px;
            text-align: right;
            font-weight: 600;
            color: var(--gold);
        }
        
        /* v7.3: Í∏ÄÎ°úÎ≤å ÌÜµÍ≥Ñ */
        .global-stats {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 11px;
        }
        .global-title {
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }
        .global-row {
            color: #888;
            margin-bottom: 4px;
        }
        .global-row b { color: #fff; }
        .global-rank {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: var(--gold);
            font-weight: 700;
        }
        
        /* v7.3: Ïò§ÎäòÏùò Î±ÉÏßÄ */
        .today-badge {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,107,53,0.1));
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 12px;
            padding: 10px 14px;
            margin: 12px 0;
        }
        .today-badge-icon {
            font-size: 28px;
            animation: badgeBounce 0.5s infinite alternate;
        }
        @keyframes badgeBounce {
            from { transform: scale(1) rotate(-5deg); }
            to { transform: scale(1.1) rotate(5deg); }
        }
        .today-badge-text { text-align: left; }
        .today-badge-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--gold);
        }
        .today-badge-desc {
            font-size: 10px;
            color: #888;
        }
        
        /* Near Miss ÎπÑÍµê Ï∂îÍ∞Ä */
        .near-miss-compare {
            font-size: 10px;
            color: var(--gold);
            margin-top: 4px;
        }
        
        /* ÏÉÅÏ†ê */
        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 16px; }
        .shop-item { 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 12px; padding: 14px; text-align: center; 
            cursor: pointer; transition: all 0.2s; 
        }
        .shop-item:hover:not(.off) { border-color: var(--gold); }
        .shop-item.off { opacity: 0.4; pointer-events: none; }
        .shop-emoji { font-size: 28px; }
        .shop-name { font-size: 12px; font-weight: 600; margin: 6px 0 4px; }
        .shop-price { font-size: 11px; color: var(--gold); }
        .shop-own { font-size: 9px; color: #666; margin-top: 4px; }
        
        .popup-close { 
            width: 100%; padding: 12px; 
            background: rgba(255,255,255,0.08); 
            border: none; border-radius: 10px; 
            color: #fff; font-size: 13px; font-weight: 600; 
            cursor: pointer; font-family: inherit; margin-top: 16px; 
        }
        
        /* ÏÑ§Ï†ï */
        .settings-list { margin-top: 16px; }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 18px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 15px;
        }
        .toggle {
            font-weight: 700;
            font-size: 14px;
            padding: 6px 14px;
            border-radius: 20px;
            background: var(--gold);
            color: #000;
        }
        .toggle.off { background: rgba(255,255,255,0.1); color: #666; }
        
        /* ÌÜ†Ïä§Ìä∏ */
        .toast { 
            position: fixed; top: 60px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.95); 
            border: 1px solid rgba(255,215,0,0.3); 
            padding: 10px 20px; border-radius: 24px; 
            font-size: 13px; font-weight: 600; z-index: 600; 
            animation: toastAnim 1.5s ease forwards; white-space: nowrap; 
        }
        @keyframes toastAnim { 
            0% { opacity: 0; transform: translateX(-50%) translateY(-10px); } 
            15%,85% { opacity: 1; transform: translateX(-50%) translateY(0); } 
            100% { opacity: 0; } 
        }
        
        /* ÏΩîÏù∏ ÌåùÏóÖ */
        .coin-pop { 
            position: fixed; font-size: 16px; font-weight: 700; 
            color: var(--gold); text-shadow: 0 0 8px rgba(255,215,0,0.5); 
            z-index: 400; animation: coinAnim 0.6s ease forwards; pointer-events: none; 
        }
        @keyframes coinAnim { 
            0% { opacity: 0; transform: translateY(0) scale(0.8); } 
            20% { opacity: 1; transform: translateY(-10px) scale(1); } 
            100% { opacity: 0; transform: translateY(-30px); } 
        }
        
        /* ÏÜêÏã§ ÏΩîÏù∏ ÌåùÏóÖ */
        .coin-loss {
            position: fixed; font-size: 16px; font-weight: 700;
            color: #ff3b30; text-shadow: 0 0 8px rgba(255,0,0,0.5);
            z-index: 400; pointer-events: none;
            animation: coinLossAnim 0.8s ease forwards;
        }
        @keyframes coinLossAnim {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(10px) scale(1.2); }
            100% { opacity: 0; transform: translateY(50px); }
        }
    </style>
</head>
<body>
    <div id="fx"></div>
    
    <!-- v7.2: ÏãúÍ∞Ñ Î∂ÑÏúÑÍ∏∞ Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="time-atmosphere" id="timeAtmosphere"></div>
    
    <!-- v7.2: ÌîºÎ≤Ñ ÎÇòÏù¥Ìä∏ÌÅ¥ÎüΩ Ìö®Í≥º -->
    <div class="fever-nightclub" id="feverNightclub"></div>
    
    <!-- v7.2: ÌîºÎ≤Ñ Î¨¥Ï†Å ÌëúÏãú -->
    <div class="fever-invincible" id="feverInvincible">üõ°Ô∏è Î¨¥Ï†Å! ÎßàÏùåÍªè ÌÅ¥Î¶≠!</div>
    
    <!-- v7.3: ÌîÑÎ¶¨Ï¶à ÌååÎûÄÏÉâ ÌôîÎ©¥ -->
    <div class="freeze-overlay" id="freezeOverlay"></div>
    
    <!-- v7.3: ÏïÑÏù¥ÌÖú ÌûåÌä∏ ÎßêÌíçÏÑ† -->
    <div class="item-hint" id="itemHint">üí° ÏïÑÏù¥ÌÖúÏùÑ ÏÇ¨Ïö©Ìï¥Î≥¥ÏÑ∏Ïöî!</div>
    
    <!-- ÏúÑÌóò Î™®Îìú Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="danger-vignette" id="dangerVignette"></div>
    <div class="heartbeat-overlay" id="heartbeatOverlay"></div>
    
    <!-- ÏΩ§Î≥¥ ÎÅäÍπÄ Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="combo-break-overlay" id="comboBreakOverlay">
        <div class="combo-break-text" id="comboBreakText">üíî 5 COMBO LOST!</div>
    </div>
    
    <!-- ÏãúÍ∞Ñ Ï∞®Í∞ê ÌëúÏãú -->
    <div class="time-penalty" id="timePenalty">-1Ï¥à</div>
    
    <!-- Îü≠ÌÇ§ ÌÉÄÏûÑ Î∞∞ÎÑà -->
    <div class="lucky-time-banner" id="luckyBanner">
        <div>üéâ LUCKY TIME! üéâ</div>
        <div style="font-size:14px;margin-top:5px;">30Ï¥àÍ∞Ñ ÏΩîÏù∏ x2!</div>
    </div>
    
    <!-- Îü≠ÌÇ§ ÌÉÄÏûÑ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ -->
    <div class="lucky-indicator" id="luckyIndicator">
        <span>üçÄ</span>
        <span>x2</span>
        <span id="luckyTimer">30</span>
    </div>
    
    <!-- Ïã§ÏãúÍ∞Ñ ÌîºÎìú -->
    <div class="feed"><div class="feed-inner" id="feed"></div></div>
    
    <!-- ÌîºÎ≤ÑÎ∞î -->
    <div class="fever-wrap"><div class="fever-bar" id="feverBar"></div></div>
    <div class="fever-label">FEVER</div>
    <div class="fever-mode" id="feverMode">üî• FEVER x2 üî•</div>
    
    <!-- GO! ÌÖçÏä§Ìä∏ -->
    <div class="go-text" id="goText">GO!</div>
    
    <!-- Ìó§Îçî -->
    <div class="header">
        <div class="stat">Lv.<span id="uiLv">1</span></div>
        <div class="stat gold">ü™ô <span id="uiCoin">0</span></div>
    </div>
    
    <!-- Ïó∞ÏÜç Ïã§Ïàò Ïπ¥Ïö¥ÌÑ∞ -->
    <div class="mistake-counter" id="mistakeCounter">Ïó∞ÏÜç 2Ìöå Ïã§Ïàò! Îã§ÏùåÏóî -2Ï¥à</div>
    
    <!-- ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§ ÌëúÏãú -->
    <div class="combo-bonus" id="comboBonus">
        <div>ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§</div>
        <div class="combo-bonus-value" id="comboBonusValue">+0%</div>
    </div>
    
    <!-- Í≤åÏûÑ -->
    <div class="game">
        <div class="mega-timer" id="megaTimer">
            <div class="timer-value" id="timerValue">40</div>
            <div class="timer-ms" id="timerMs">.00</div>
            <div class="tick-indicator" id="tickIndicator">‚è∞</div>
        </div>
        
        <div class="combo">
            <span class="combo-fire" id="comboFire">üî•</span>
            <span class="combo-text" id="comboText"></span>
            <span class="combo-mult" id="comboMult"></span>
        </div>
        <div class="level-box">
            <div class="level-text">Level <span id="uiLevel">1</span></div>
            <div class="level-sub" id="levelSub">Ïπ¥Îìú 3Ïåç</div>
        </div>
        <div class="grid" id="grid"></div>
    </div>
    
    <!-- ÏïÑÏù¥ÌÖú -->
    <div class="items">
        <button class="item" onclick="useItem('gun')" id="btnGun" disabled>üî´<span class="item-cnt" id="cntGun">0</span></button>
        <button class="item" onclick="useItem('time')" id="btnTime" disabled>‚è∞<span class="item-cnt" id="cntTime">0</span></button>
        <button class="item" onclick="useItem('hint')" id="btnHint" disabled>üí°<span class="item-cnt" id="cntHint">0</span></button>
        <button class="item" onclick="useItem('freeze')" id="btnFreeze" disabled>‚ùÑÔ∏è<span class="item-cnt" id="cntFreeze">0</span></button>
        <button class="item" onclick="showShop()">üõí</button>
    </div>
    
    <!-- Î±ÉÏßÄ Î≤ÑÌäº -->
    <div class="badge-btn" onclick="showBadges()">üèÜ<span class="badge-cnt" id="badgeCnt">0</span></div>
    
    <!-- ÏãúÏûë ÌôîÎ©¥ -->
    <div class="overlay on" id="scrStart">
        <div class="settings-btn" onclick="showSettings()">‚öôÔ∏è</div>
        <div class="start-logo">üÉè</div>
        <div class="start-title">ÎèÑÌååÎß§Ïπò</div>
        <div class="start-sub">DOPPAMATCH</div>
        
        <!-- Ïò§ÎäòÏùò ÎèÑÏ†Ñ -->
        <div class="daily-challenge">
            <div class="daily-title">üéØ Ïò§ÎäòÏùò ÎèÑÏ†Ñ</div>
            <div class="daily-goal" id="dailyGoal">Î†àÎ≤® 10 ÎèÑÎã¨ÌïòÍ∏∞</div>
            <div class="daily-reward">Î≥¥ÏÉÅ: <b>üíé 500 ÏΩîÏù∏</b></div>
            <div class="daily-progress">
                <div class="daily-progress-bar" id="dailyProgressBar"></div>
            </div>
        </div>
        
        <!-- ÏµúÍ≥† Í∏∞Î°ù -->
        <div class="best-record">
            <span>üèÜ ÏµúÍ≥† <b id="bestLevel">Lv.1</b></span>
            <span>‚ö° ÏµúÎåÄ <b id="bestCombo">0ÏΩ§Î≥¥</b></span>
        </div>
        
        <button class="btn-start" onclick="startGame()">ÎèÑÏ†Ñ ÏãúÏûë!</button>
        <div class="sound-hint" id="soundHint">üîä ÌÑ∞ÏπòÌïòÎ©¥ ÏùåÏïÖÏù¥ ÏãúÏûëÎê©ÎãàÎã§</div>
    </div>
    
    <!-- ÏÑ§Ï†ï -->
    <div class="overlay" id="scrSettings">
        <div class="popup">
            <div class="popup-title">‚öôÔ∏è ÏÑ§Ï†ï</div>
            <div class="settings-list">
                <div class="setting-row" onclick="toggleSound()">
                    <span>üîä ÏÇ¨Ïö¥Îìú</span>
                    <span class="toggle" id="toggleSound">ON</span>
                </div>
                <div class="setting-row" onclick="toggleVibration()">
                    <span>üì≥ ÏßÑÎèô</span>
                    <span class="toggle" id="toggleVibration">ON</span>
                </div>
            </div>
            <button class="popup-close" onclick="closeSettings()">Îã´Í∏∞</button>
        </div>
    </div>
    
    <!-- ÌçΩ ÏÑ†ÌÉù -->
    <div class="overlay" id="scrPerk">
        <div class="popup">
            <div class="popup-title">üéâ LEVEL CLEAR!</div>
            <p style="text-align:center;color:#888;font-size:12px;">Î≥¥ÏÉÅÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
            <div class="perk-countdown" id="perkCountdown">5</div>
            <div class="perk-timer">
                <div class="perk-timer-bar" id="perkTimerBar"></div>
            </div>
            <div class="perk-list" id="perkList"></div>
        </div>
    </div>
    
    <!-- Î≥¥ÎÑàÏä§ ÎùºÏö¥Îìú -->
    <div class="overlay" id="scrBonus">
        <div class="popup" style="text-align:center;">
            <div class="popup-title">üé∞ Î≥¥ÎÑàÏä§ Ïä¨Î°Ø!</div>
            <div class="slot-wrap">
                <div class="slot" id="slot0">?</div>
                <div class="slot" id="slot1">?</div>
                <div class="slot" id="slot2">?</div>
            </div>
            <button class="btn-spin" id="btnSpin" onclick="spinSlot()">Ïä§ÌïÄ!</button>
        </div>
    </div>
    
    <!-- Í≤åÏûÑÏò§Î≤Ñ -->
    <div class="overlay" id="scrOver">
        <div class="popup" style="text-align:center; max-height: 90vh; overflow-y: auto;">
            <div class="go-title">GAME OVER</div>
            
            <!-- Near Miss Í∞ïÏ°∞ -->
            <div class="near-miss" id="nearMiss" style="display:none;">
                <div class="near-miss-text" id="nearMissText">üò± 1ÏåçÎßå Îçî ÎßûÏ∂îÎ©¥ ÎêêÎäîÎç∞!</div>
                <div class="near-miss-detail" id="nearMissDetail">3.2Ï¥àÎßå Îçî ÏûàÏóàÎã§Î©¥...</div>
                <div class="near-miss-compare" id="nearMissCompare">üìä ÎèÑÌååÎß§Ïπò ÌèâÍ∑†: 2.1Ï¥àÎ©¥ ÌÅ¥Î¶¨Ïñ¥</div>
            </div>
            
            <div class="go-score" id="finalCoin">0</div>
            <div style="font-size:12px;color:#888;">Total Coins</div>
            
            <div class="go-stats">
                <div class="go-stat"><div class="go-stat-val" id="finalLv">1</div><div class="go-stat-lbl">Î†àÎ≤®</div></div>
                <div class="go-stat"><div class="go-stat-val" id="finalCombo">0</div><div class="go-stat-lbl">ÏµúÎåÄÏΩ§Î≥¥</div></div>
                <div class="go-stat"><div class="go-stat-val" id="finalBadge">0</div><div class="go-stat-lbl">Î±ÉÏßÄ</div></div>
            </div>
            
            <!-- v7.3: Í∞ÄÏßú ÌÜµÍ≥Ñ + Îä•Î†• Î∂ÑÏÑù -->
            <div class="analysis-box" id="analysisBox">
                <div class="analysis-title">üß† ÎãπÏã†Ïùò Î∂ÑÏÑù</div>
                <div class="analysis-row">
                    <span>Í∏∞ÏñµÎ†•</span>
                    <div class="analysis-bar"><div class="analysis-fill" id="memoryBar" style="width:60%"></div></div>
                    <span class="analysis-pct" id="memoryPct">ÏÉÅÏúÑ 40%</span>
                </div>
                <div class="analysis-row">
                    <span>Î∞òÏùëÏÜçÎèÑ</span>
                    <div class="analysis-bar"><div class="analysis-fill" id="speedBar" style="width:45%"></div></div>
                    <span class="analysis-pct" id="speedPct">ÏÉÅÏúÑ 55%</span>
                </div>
                <div class="analysis-row">
                    <span>ÏßëÏ§ëÎ†•</span>
                    <div class="analysis-bar"><div class="analysis-fill" id="focusBar" style="width:70%"></div></div>
                    <span class="analysis-pct" id="focusPct">ÏÉÅÏúÑ 30%</span>
                </div>
            </div>
            
            <!-- v7.3: Í∏ÄÎ°úÎ≤å ÌÜµÍ≥Ñ -->
            <div class="global-stats" id="globalStats">
                <div class="global-title">üìä ÎèÑÌååÎß§Ïπò ÌÜµÍ≥Ñ</div>
                <div class="global-row">Ï†ÑÏ≤¥ Ïù¥Ïö©Ïûê: <b>1,593,847</b>Î™Ö</div>
                <div class="global-row" id="levelPassRow">Î†àÎ≤® <span id="passLevel">9</span> ÌÜµÍ≥º: <b id="passCount">52,847</b>Î™Ö (<span id="passPct">3.3%</span>)</div>
                <div class="global-rank">ÎãπÏã†: <b id="yourRank">ÏÉÅÏúÑ 3.3%</b> üèÜ</div>
            </div>
            
            <!-- v7.3: Ïò§ÎäòÏùò Î±ÉÏßÄ -->
            <div class="today-badge" id="todayBadge">
                <div class="today-badge-icon" id="todayBadgeIcon">üî•</div>
                <div class="today-badge-text">
                    <div class="today-badge-name" id="todayBadgeName">Í∑ºÏÑ±Í∞ÄÏù¥</div>
                    <div class="today-badge-desc" id="todayBadgeDesc">ÎÅùÍπåÏßÄ Ìè¨Í∏∞ÌïòÏßÄ ÏïäÏùå</div>
                </div>
            </div>
            
            <button class="btn-revive" id="btnRevive" onclick="revive()">‚ù§Ô∏è Î¨¥Î£å Î∂ÄÌôú! (+8Ï¥à)</button>
            <button class="btn-revenge" onclick="restart()">üîÑ Îã§Ïãú ÎèÑÏ†Ñ</button>
            <button class="btn-badges" onclick="showBadgesFromGameOver()">üèÜ Î±ÉÏßÄ Ïª¨Î†âÏÖò</button>
            <button class="btn-giveup" onclick="giveUp()">üè† ÌôàÏúºÎ°ú</button>
        </div>
    </div>
    
    <!-- ÏÉÅÏ†ê -->
    <div class="overlay" id="scrShop">
        <div class="popup">
            <div class="popup-title">üõí ÏÉÅÏ†ê</div>
            <div style="text-align:center;color:var(--gold);font-weight:700;margin-bottom:12px;">ü™ô <span id="shopCoin">0</span></div>
            <div class="shop-grid" id="shopGrid"></div>
            <button class="popup-close" onclick="closeShop()">Îã´Í∏∞</button>
        </div>
    </div>
    
    <!-- Î±ÉÏßÄ -->
    <div class="overlay" id="scrBadge">
        <div class="popup">
            <div class="popup-title">üèÜ Î±ÉÏßÄ Ïª¨Î†âÏÖò</div>
            <div class="badge-grid" id="badgeGrid"></div>
            <button class="popup-close" onclick="closeBadges()">Îã´Í∏∞</button>
        </div>
    </div>

<script>
/*
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * ÎèÑÌååÎß§Ïπò (DoppaMatch) v7.0
 * 
 * üß† Ïπ¥ÏßÄÎÖ∏ Ïã¨Î¶¨Ìïô Í∏∞Î∞ò Ï§ëÎèÖ Î©îÏª§ÎãàÏ¶ò
 * 
 * Ï†ÅÏö©Îêú ÏõêÎ¶¨:
 * 1. ÏÜêÏã§ ÌöåÌîº (Loss Aversion) - ÌãÄÎ¶¨Î©¥ ÏãúÍ∞Ñ Ï∞®Í∞ê, ÏΩ§Î≥¥ ÎÅäÍπÄ ÏïÑÌîî
 * 2. Í∞ÄÎ≥Ä Î≥¥ÏÉÅ (Variable Ratio) - Îü≠ÌÇ§ ÌÉÄÏûÑ, ÏïÑÏù¥ÌÖú ÎìúÎ°≠
 * 3. Near Miss Ìö®Í≥º - "Í±∞Ïùò ÏÑ±Í≥µ"ÏùÑ Í∞ïÏ°∞ÌïòÏó¨ Ïû¨ÎèÑÏ†Ñ Ïú†ÎèÑ
 * 4. ÏóêÏä§Ïª¨Î†àÏù¥ÌåÖ Í∏¥Ïû• - ÏãúÍ∞Ñ ÏïïÎ∞ïÏù¥ Ï†êÏ†ê Í∑πÏ†ÅÏúºÎ°ú
 * 5. Îß§Î™∞ ÎπÑÏö© Ìö®Í≥º - "Ïó¨Í∏∞ÏÑú Í∑∏ÎßåÎëêÎ©¥ Î™®Îì† Í≤å ÏÇ¨ÎùºÏ†∏Ïöî"
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 */

// ===== ÏÑ§Ï†ï =====
const Settings = {
    sound: true,
    vibration: true
};

// ===== ÏòÅÍµ¨ Îç∞Ïù¥ÌÑ∞ (localStorage) =====
const SaveData = {
    bestLevel: parseInt(localStorage.getItem('bestLevel')) || 1,
    bestCombo: parseInt(localStorage.getItem('bestCombo')) || 0,
    totalCoins: parseInt(localStorage.getItem('totalCoins')) || 0,
    gamesPlayed: parseInt(localStorage.getItem('gamesPlayed')) || 0,
    
    save() {
        localStorage.setItem('bestLevel', this.bestLevel);
        localStorage.setItem('bestCombo', this.bestCombo);
        localStorage.setItem('totalCoins', this.totalCoins);
        localStorage.setItem('gamesPlayed', this.gamesPlayed);
    }
};

// ===== Ïù¥Î™®ÏßÄ (ÏïàÏ†ÑÌïú 32Í∞ú) =====
const EMOJIS = [
    'üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº',
    'üê®','üêØ','ü¶Å','üêÆ','üê∑','üê∏','üêµ','üêî',
    'üêß','üê¶','üê§','ü¶Ü','ü¶Ö','ü¶â','üê∫','üêó',
    'üê¥','üêù','üêõ','ü¶ã','üêå','üêû','üêú','ü¶é'
];

// ===== ÌçΩ =====
const PERKS = [
    { id: 'time', icon: '‚è≥', name: 'ÏãúÍ∞ÑÏùò ÏßÄÎ∞∞Ïûê', desc: 'Í∏∞Î≥∏ ÏãúÍ∞Ñ +3Ï¥à', fn: () => G.baseTime += 3 },
    { id: 'fever', icon: 'üî•', name: 'Ïó¥Ï†ïÎß®', desc: 'ÌîºÎ≤Ñ Ï∂©Ï†Ñ +40%', fn: () => G.feverRate *= 1.4 },
    { id: 'gold', icon: 'üí∞', name: 'Î∂ÄÏûê', desc: 'ÏΩîÏù∏ ÌöçÎìù +30%', fn: () => G.coinMult *= 1.3 },
    { id: 'gun', icon: 'üî´', name: 'Í±¥Ïä¨ÎßÅÍ±∞', desc: 'Îß§ ÎùºÏö¥Îìú Ï¥ù +1', fn: () => G.startItems.gun++ },
    { id: 'hint', icon: 'üí°', name: 'ÌÜµÏ∞∞Î†•', desc: 'Îß§ ÎùºÏö¥Îìú ÌûåÌä∏ +1', fn: () => G.startItems.hint++ },
    { id: 'auto', icon: 'ü§ñ', name: 'Ïò§ÌÜ†Î¥á', desc: 'ÏãúÏûë Ïãú 1Ïåç ÏûêÎèôÎß§Ïπ≠', fn: () => G.autoMatch = true },
    { id: 'combo', icon: '‚ö°', name: 'ÏΩ§Î≥¥ ÎßàÏä§ÌÑ∞', desc: 'ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§ +50%', fn: () => G.comboMult *= 1.5 },
    { id: 'shield', icon: 'üõ°Ô∏è', name: 'Ïã§Ïàò Î∞©ÏßÄ', desc: 'Ï≤´ Ïã§Ïàò ÏãúÍ∞Ñ Ï∞®Í∞ê ÏóÜÏùå', fn: () => G.hasShield = true },
];

// ===== Î±ÉÏßÄ =====
const BADGES = [
    { id: 'start', icon: 'üéâ', name: 'Ï≤´ ÏãúÏûë', ck: () => true },
    { id: 'c3', icon: 'üî•', name: '3ÏΩ§Î≥¥', ck: () => G.maxCombo >= 3 },
    { id: 'c5', icon: 'üí•', name: '5ÏΩ§Î≥¥', ck: () => G.maxCombo >= 5 },
    { id: 'c10', icon: '‚ö°', name: '10ÏΩ§Î≥¥', ck: () => G.maxCombo >= 10 },
    { id: 'lv5', icon: '‚≠ê', name: 'Lv.5', ck: () => G.level >= 5 },
    { id: 'lv10', icon: 'üåü', name: 'Lv.10', ck: () => G.level >= 10 },
    { id: 'lv25', icon: '‚ú®', name: 'Lv.25', ck: () => G.level >= 25 },
    { id: 'coin1k', icon: 'ü™ô', name: '1,000ÏΩîÏù∏', ck: () => G.coins >= 1000 },
    { id: 'coin5k', icon: 'üí∞', name: '5,000ÏΩîÏù∏', ck: () => G.coins >= 5000 },
    { id: 'coin10k', icon: 'üíé', name: '10,000ÏΩîÏù∏', ck: () => G.coins >= 10000 },
    { id: 'fever', icon: 'üåà', name: 'ÌîºÎ≤Ñ Î∞úÎèô', ck: () => G.gotFever },
    { id: 'bonus', icon: 'üé∞', name: 'Î≥¥ÎÑàÏä§ ÌÅ¥Î¶¨Ïñ¥', ck: () => G.gotBonus },
    { id: 'speed', icon: 'üèÉ', name: 'Ïä§ÌîºÎìúÎü∞', ck: () => G.gotSpeed },
    { id: 'perfect', icon: 'üëë', name: 'ÌçºÌéôÌä∏', ck: () => G.gotPerfect },
    { id: 'shop10', icon: 'üõçÔ∏è', name: 'ÏáºÌçº', ck: () => G.shopCnt >= 10 },
    { id: 'perk5', icon: 'üß¨', name: 'ÏßÑÌôî', ck: () => G.perkCnt >= 5 },
];

// ===== Í≤åÏûÑ ÏÉÅÌÉú =====
const G = {
    level: 1, coins: 0, combo: 0, maxCombo: 0,
    time: 12, maxTime: 12, baseTime: 12,  // v7.3: Í∑πÎã®Ï†Å ÏãúÍ∞Ñ Ï†úÌïú!
    cards: [], flipped: [], matched: 0, total: 0,
    running: false, canFlip: false, timer: null,
    items: { gun: 1, time: 2, hint: 2, freeze: 1 },
    prices: { gun: 150, time: 80, hint: 100, freeze: 120 },
    bought: { gun: 0, time: 0, hint: 0, freeze: 0 },
    fever: 0, feverOn: false, frozenTime: 0,
    hasRevive: true, shopCnt: 0, perkCnt: 0,
    badges: {},
    feverRate: 1, coinMult: 1, comboMult: 1, dropRate: 0.25,
    startItems: { gun: 0, time: 0, hint: 0, freeze: 0 },
    autoMatch: false,
    gotFever: false, gotBonus: false, gotSpeed: false, gotPerfect: false,
    mistakes: 0,
    lastTick: 0,
    currentBgmSpeed: 1.0,
    
    // ‚ïê‚ïê‚ïê üî¥ v7 Ï∂îÍ∞Ä: ÏÜêÏã§ ÌöåÌîº ÏãúÏä§ÌÖú ‚ïê‚ïê‚ïê
    consecutiveMistakes: 0,  // Ïó∞ÏÜç Ïã§Ïàò ÌöüÏàò
    hasShield: false,        // Ïã§Ïàò Î∞©ÏßÄ Ïâ¥Îìú
    luckyTimeActive: false,  // Îü≠ÌÇ§ ÌÉÄÏûÑ
    luckyTimeRemaining: 0,   // Îü≠ÌÇ§ ÌÉÄÏûÑ ÎÇ®ÏùÄ ÏãúÍ∞Ñ
    lastMatchedPairs: 0,     // ÎßàÏßÄÎßâ Îß§Ïπ≠Îêú Ïåç Ïàò (Near MissÏö©)
};

// ===== Ïú†Ìã∏ =====
const $ = id => document.getElementById(id);
const shuffled = arr => [...arr].sort(() => Math.random() - 0.5);

// ===== ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú =====
const audioManager = { 
    sounds: {}, 
    bgm: null,
    introBgm: null,
    feverBgm: null,
    heartbeatSound: null,
    enabled: true, 
    initialized: false,
    audioPool: [],
    maxPoolSize: 20,
    
    init() { 
        if (this.initialized) return; 
        
        const files = { 
            flip: 'flip.wav', 
            match: 'match.mp3', 
            wrong: 'wrong.wav', 
            combo: 'combo.mp3', 
            win: 'win.mp3', 
            fail: 'fail.mp3',
            item: 'item.wav', 
            gun: 'gun.mp3',
            time: 'time.mp3', 
            hint: 'hint.mp3', 
            spin: 'spin.mp3', 
            pop: 'pop.mp3',
            freeze: 'freeze.mp3',
            shuffle: 'shuffle.mp3', 
            coin: 'coin.mp3', 
            tick: 'tick.mp3',
            click: 'click.mp3',
            letsgo: 'letsgo.mp3',
            // v7 Ï∂îÍ∞Ä
            comboBreak: 'wrong.wav',  // ÏΩ§Î≥¥ ÎÅäÍπÄ (wrong Ïû¨ÌôúÏö©)
            danger: 'tick.mp3',       // ÏúÑÌóò (tick Ïû¨ÌôúÏö©)
            lucky: 'win.mp3',         // Îü≠ÌÇ§ ÌÉÄÏûÑ
        }; 
        
        for (const [k, f] of Object.entries(files)) { 
            this.sounds[k] = new Audio(f); 
        } 
        
        this.bgm = new Audio('bgm.wav'); 
        this.bgm.loop = true; 
        this.bgm.volume = 0.5; 

        this.introBgm = new Audio('intro.wav');
        this.introBgm.loop = true;
        this.introBgm.volume = 0.5;

        this.feverBgm = new Audio('fevertime.wav');
        this.feverBgm.loop = true;
        this.feverBgm.volume = 0.55;
        
        // Ïã¨Ïû•Î∞ïÎèô ÏÇ¨Ïö¥Îìú (ÏúÑÌóò Î™®ÎìúÏö©)
        this.heartbeatSound = new Audio('tick.mp3');
        this.heartbeatSound.loop = true;
        this.heartbeatSound.volume = 0.6;
        
        this.initialized = true; 
    }, 
    
    play(name) { 
        if (!this.enabled || !Settings.sound || !this.sounds[name]) return; 
        try { 
            const s = this.sounds[name].cloneNode(); 
            if (name === 'click') s.volume = 0.2;
            else if (name === 'tick') s.volume = 0.5;
            else if (name === 'comboBreak') s.volume = 0.6;
            else s.volume = 0.4; 
            
            this.audioPool.push(s);
            s.onended = () => {
                const idx = this.audioPool.indexOf(s);
                if (idx > -1) this.audioPool.splice(idx, 1);
            };
            while (this.audioPool.length > this.maxPoolSize) {
                const old = this.audioPool.shift();
                old.pause();
            }
            s.play().catch(() => {}); 
        } catch(e) {} 
    }, 
    
    stopAllSFX() {
        this.audioPool.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });
        this.audioPool = [];
        if (this.heartbeatSound) {
            this.heartbeatSound.pause();
            this.heartbeatSound.currentTime = 0;
        }
    },
    
    playBGM(type = 'game') { 
        if (!this.enabled || !Settings.sound) return;
        this.stopBGM(); 
        G.currentBgmSpeed = 1.0;

        if (type === 'intro') {
            this.introBgm.play().catch(()=>{});
        } else if (type === 'fever') {
            this.feverBgm.play().catch(()=>{});
        } else {
            this.bgm.playbackRate = 1.0; 
            this.bgm.play().catch(()=>{});
        }
    }, 
    
    stopBGM() { 
        [this.bgm, this.introBgm, this.feverBgm].forEach(music => {
            if(music) { music.pause(); music.currentTime = 0; }
        });
    },

    setSpeed(rate) {
        if (G.currentBgmSpeed === rate) return;
        G.currentBgmSpeed = rate;
        if (this.bgm && !this.bgm.paused) {
            this.bgm.playbackRate = Math.min(rate, 1.5);
        }
    },
    
    // v7: Ïã¨Ïû•Î∞ïÎèô ÏãúÏûë/Ï†ïÏßÄ
    startHeartbeat(bpm = 120) {
        if (!Settings.sound) return;
        // Ïã§Ï†ú heartbeat ÏÇ¨Ïö¥Îìú ÌååÏùºÏù¥ ÏóÜÏúºÎØÄÎ°ú tickÏúºÎ°ú ÎåÄÏ≤¥
        const interval = 60000 / bpm;
        document.documentElement.style.setProperty('--heartbeat', (interval / 1000) + 's');
    },
    
    stopHeartbeat() {
        if (this.heartbeatSound) {
            this.heartbeatSound.pause();
        }
    },
    
    toggle() { 
        this.enabled = !this.enabled; 
        Settings.sound = this.enabled;
        if (!this.enabled) this.stopBGM();
        return this.enabled; 
    } 
};

// Ïò§ÎîîÏò§ Ïû†Í∏à Ìï¥Ï†ú
let audioUnlocked = false;
function unlockAudio() {
    if (audioUnlocked) return;
    audioUnlocked = true;
    audioManager.init();
    if (Settings.sound && $('scrStart').classList.contains('on')) {
        audioManager.playBGM('intro');
    }
    const hint = $('soundHint');
    if (hint) hint.style.display = 'none';
}

['click', 'touchstart', 'keydown'].forEach(evt => {
    document.addEventListener(evt, unlockAudio, { once: true });
});

document.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON' || e.target.classList.contains('item')) {
        audioManager.play('click');
    }
});

// ===== ÏßÑÎèô =====
function vibrate(pattern) {
    if (Settings.vibration && navigator.vibrate) {
        navigator.vibrate(pattern);
    }
}

// ===== ÌååÌã∞ÌÅ¥ =====
const MAX_PARTICLES = 50;
function particles(x, y, n = 10, type = 'normal') {
    const syms = type === 'damage' ? ['üíî','‚ùå','üòµ'] : ['‚ú®','‚≠ê','üåü','üí´','üî∂'];
    const fx = $('fx');
    const currentCount = fx.children.length;
    n = Math.min(n, MAX_PARTICLES - currentCount);
    
    for (let i = 0; i < n; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.textContent = syms[Math.floor(Math.random() * syms.length)];
        p.style.left = x + 'px';
        p.style.top = y + 'px';
        p.style.fontSize = (12 + Math.random() * 10) + 'px';
        const a = Math.random() * Math.PI * 2;
        const v = 60 + Math.random() * 60;
        p.style.setProperty('--x', Math.cos(a) * v + 'px');
        p.style.setProperty('--y', Math.sin(a) * v + 'px');
        fx.appendChild(p);
        setTimeout(() => p.remove(), 700);
    }
}

function shake(type = 'normal') {
    document.body.classList.remove('shake', 'shake-hard', 'shake-damage');
    void document.body.offsetWidth;
    if (type === 'damage') {
        document.body.classList.add('shake-damage');
        vibrate([50, 30, 100]);
    } else if (type === 'hard') {
        document.body.classList.add('shake-hard');
        vibrate(80);
    } else {
        document.body.classList.add('shake');
        vibrate(30);
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üî¥ v7: ÏúÑÌóò Î™®Îìú ÏãúÏä§ÌÖú
// Ïã¨Î¶¨Ìïô: ÏãúÍ∞Ñ ÏïïÎ∞ïÏùÄ ÏïÑÎìúÎ†àÎÇ†Î¶∞ÏùÑ Î∂ÑÎπÑÏãúÌÇ§Í≥† "Ìïú Î≤à Îçî" Ïã¨Î¶¨Î•º ÏûêÍ∑π
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateDangerMode() {
    const sec = Math.floor(G.time);
    const vignette = $('dangerVignette');
    const heartbeat = $('heartbeatOverlay');
    const megaTimer = $('megaTimer');
    
    // ÌÅ¥ÎûòÏä§ Ï¥àÍ∏∞Ìôî
    vignette.classList.remove('on', 'critical');
    heartbeat.classList.remove('on');
    megaTimer.classList.remove('warning', 'danger', 'critical', 'frozen');
    document.body.classList.remove('danger-mode', 'critical-mode');
    
    if (G.frozenTime > 0) {
        megaTimer.classList.add('frozen');
        return;
    }
    
    if (sec <= 3) {
        // üî¥ CRITICAL: 3Ï¥à Ïù¥Ìïò
        vignette.classList.add('critical');
        heartbeat.classList.add('on');
        megaTimer.classList.add('critical');
        document.body.classList.add('critical-mode');
        document.documentElement.style.setProperty('--heartbeat', '0.3s');
    } else if (sec <= 5) {
        // üü† DANGER: 5Ï¥à Ïù¥Ìïò
        vignette.classList.add('on');
        heartbeat.classList.add('on');
        megaTimer.classList.add('danger');
        document.body.classList.add('danger-mode');
        document.documentElement.style.setProperty('--heartbeat', '0.5s');
    } else if (sec <= 10) {
        // üü° WARNING: 10Ï¥à Ïù¥Ìïò
        megaTimer.classList.add('warning');
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üíî v7: ÏΩ§Î≥¥ ÎÅäÍπÄ Ìö®Í≥º
// Ïã¨Î¶¨Ìïô: Ï∂ïÏ†ÅÎêú Í≤ÉÏùÑ ÏûÉÎäî Í≥†ÌÜµ > Ï≤òÏùåÎ∂ÄÌÑ∞ ÏóÜÎäî Í≤É
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showComboBreak(lostCombo) {
    if (lostCombo < 3) return;  // 3ÏΩ§Î≥¥ Ïù¥ÏÉÅÏùº ÎïåÎßå ÌëúÏãú
    
    const overlay = $('comboBreakOverlay');
    const text = $('comboBreakText');
    
    text.textContent = `üíî ${lostCombo} COMBO LOST!`;
    overlay.classList.remove('show');
    void overlay.offsetWidth;
    overlay.classList.add('show');
    
    audioManager.play('comboBreak');
    shake('damage');
    vibrate([100, 50, 100, 50, 200]);
    
    setTimeout(() => overlay.classList.remove('show'), 1000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚è∞ v7: ÏãúÍ∞Ñ Ï∞®Í∞ê Ìö®Í≥º
// Ïã¨Î¶¨Ìïô: ÏÜêÏã§ÏùÑ ÏãúÍ∞ÅÏ†ÅÏúºÎ°ú Î≥¥Ïó¨Ï§òÏïº ÏïÑÌîîÏù¥ Í∑πÎåÄÌôîÎê®
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showTimePenalty(seconds) {
    const penalty = $('timePenalty');
    penalty.textContent = `-${seconds}Ï¥à`;
    penalty.classList.remove('show');
    void penalty.offsetWidth;
    penalty.classList.add('show');
    
    setTimeout(() => penalty.classList.remove('show'), 800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üçÄ v7: Îü≠ÌÇ§ ÌÉÄÏûÑ ÏãúÏä§ÌÖú
// Ïã¨Î¶¨Ìïô: ÏòàÏÉÅÏπò Î™ªÌïú Î≥¥ÎÑàÏä§ = ÎèÑÌååÎØº 400% Ï¶ùÍ∞Ä
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkLuckyTime() {
    // Îß§Ïπ≠ ÏÑ±Í≥µ Ïãú 5% ÌôïÎ•†Î°ú Îü≠ÌÇ§ ÌÉÄÏûÑ Î∞úÎèô
    if (!G.luckyTimeActive && Math.random() < 0.05) {
        activateLuckyTime();
    }
}

function activateLuckyTime() {
    G.luckyTimeActive = true;
    G.luckyTimeRemaining = 30;
    
    // Î∞∞ÎÑà ÌëúÏãú
    const banner = $('luckyBanner');
    banner.classList.add('show');
    setTimeout(() => banner.classList.remove('show'), 2000);
    
    // Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÌëúÏãú
    $('luckyIndicator').classList.add('on');
    
    audioManager.play('lucky');
    shake('hard');
    toast('üçÄ LUCKY TIME! 30Ï¥àÍ∞Ñ ÏΩîÏù∏ x2!');
    
    // Îü≠ÌÇ§ ÌÉÄÏûÑ ÌÉÄÏù¥Î®∏
    const luckyInterval = setInterval(() => {
        G.luckyTimeRemaining--;
        $('luckyTimer').textContent = G.luckyTimeRemaining;
        
        if (G.luckyTimeRemaining <= 0 || !G.running) {
            clearInterval(luckyInterval);
            G.luckyTimeActive = false;
            $('luckyIndicator').classList.remove('on');
            if (G.running) toast('Îü≠ÌÇ§ ÌÉÄÏûÑ Ï¢ÖÎ£å!');
        }
    }, 1000);
}

// ===== ÌîºÎìú =====
function initFeed() {
    const data = [
        { n: 'ProGamer', a: 'Lv.28 ÌÅ¥Î¶¨Ïñ¥', c: 4200 },
        { n: 'MemoryKing', a: '8ÏΩ§Î≥¥ Îã¨ÏÑ±', c: 3100 },
        { n: 'SpeedDemon', a: 'ÌîºÎ≤Ñ Î∞úÎèô!', c: 5600 },
        { n: 'CardMaster', a: 'Lv.35 ÎèÑÏ†ÑÏ§ë', c: 7800 },
        { n: 'LuckyOne', a: 'Îü≠ÌÇ§ÌÉÄÏûÑ Ïû≠Ìåü!', c: 9200 },
    ];
    let html = '';
    for (let i = 0; i < 2; i++) {
        data.forEach(d => {
            html += `<div class="feed-item"><span class="feed-dot"></span><b>${d.n}</b> ${d.a} <b>ü™ô${d.c}</b></div>`;
        });
    }
    $('feed').innerHTML = html;
}

// ===== UI =====
function ui() {
    $('uiLv').textContent = G.level;
    $('uiLevel').textContent = G.level;
    $('uiCoin').textContent = G.coins.toLocaleString();
    $('feverBar').style.width = G.fever + '%';
    
    const ct = $('comboText');
    const cf = $('comboFire');
    
    if (G.combo >= 2) {
        ct.textContent = G.combo + ' COMBO!';
        ct.classList.add('show');
        ct.classList.toggle('high', G.combo >= 5);
        $('comboMult').textContent = `x${(1 + G.combo * 0.1 * G.comboMult).toFixed(1)}`;
        cf.classList.toggle('show', G.combo >= 3);
    } else {
        ct.classList.remove('show', 'high');
        $('comboMult').textContent = '';
        cf.classList.remove('show');
    }
    
    ['gun','time','hint','freeze'].forEach(k => {
        const cnt = $('cnt' + k.charAt(0).toUpperCase() + k.slice(1));
        const btn = $('btn' + k.charAt(0).toUpperCase() + k.slice(1));
        if (cnt) cnt.textContent = G.items[k];
        if (btn) btn.disabled = G.items[k] <= 0 || !G.running;
    });
    
    $('badgeCnt').textContent = Object.keys(G.badges).length;
    
    // ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§ ÌëúÏãú
    const cb = $('comboBonus');
    if (G.combo >= 2 && G.running) {
        const bonusPercent = Math.floor(G.combo * 10 * G.comboMult);
        $('comboBonusValue').textContent = '+' + bonusPercent + '%';
        cb.classList.add('show');
    } else {
        cb.classList.remove('show');
    }
    
    // Ïó∞ÏÜç Ïã§Ïàò Ïπ¥Ïö¥ÌÑ∞
    const mc = $('mistakeCounter');
    if (G.consecutiveMistakes >= 2) {
        mc.textContent = `Ïó∞ÏÜç ${G.consecutiveMistakes}Ìöå Ïã§Ïàò! Îã§ÏùåÏóî -${Math.min(G.consecutiveMistakes + 1, 5)}Ï¥à`;
        mc.classList.add('show');
    } else {
        mc.classList.remove('show');
    }
}

// ===== ÌÉÄÏù¥Î®∏ =====
function updateTimerDisplay() {
    const sec = Math.floor(G.time);
    const ms = Math.floor((G.time % 1) * 100);
    
    $('timerValue').textContent = sec;
    $('timerMs').textContent = '.' + ms.toString().padStart(2, '0');
    
    // ÏúÑÌóò Î™®Îìú ÏóÖÎç∞Ïù¥Ìä∏
    updateDangerMode();
    
    // Ïß∏Íπç ÏÜåÎ¶¨ (10Ï¥à Ïù¥Ìïò)
    if (sec <= 10 && sec > 0 && sec !== G.lastTick && G.frozenTime <= 0) {
        G.lastTick = sec;
        audioManager.play('tick');
        
        const tick = $('tickIndicator');
        tick.classList.remove('show');
        void tick.offsetWidth;
        tick.classList.add('show');
        setTimeout(() => tick.classList.remove('show'), 500);
    }
}

// ===== ÏãúÏûë ÌôîÎ©¥ Ï¥àÍ∏∞Ìôî =====
function initStartScreen() {
    $('bestLevel').textContent = 'Lv.' + SaveData.bestLevel;
    $('bestCombo').textContent = SaveData.bestCombo + 'ÏΩ§Î≥¥';
    
    // Ïò§ÎäòÏùò ÎèÑÏ†Ñ (ÏùºÏùº Î™©Ìëú)
    const dailyGoal = Math.max(SaveData.bestLevel + 2, 5);
    $('dailyGoal').textContent = `Î†àÎ≤® ${dailyGoal} ÎèÑÎã¨ÌïòÍ∏∞`;
}

// ===== Í≤åÏûÑ ÏãúÏûë =====
function startGame() {
    $('scrStart').classList.remove('on');
    G.badges.start = true;
    SaveData.gamesPlayed++;
    SaveData.save();
    
    audioManager.stopBGM();
    initLevel();
    toast('ÌôîÏù¥ÌåÖ! üéÆ');
}

function initLevel() {
    G.running = false;
    G.canFlip = false;
    G.combo = 0;
    G.consecutiveMistakes = 0;
    
    // v7.3: ÌîºÎ≤Ñ Í≤åÏù¥ÏßÄ Ïú†ÏßÄ! (Îã§Ïùå Î†àÎ≤®Î°ú Ïù¥Ïñ¥Ïßê)
    // Îã®, ÌîºÎ≤ÑÍ∞Ä ÌôúÏÑ±Ìôî Ï§ëÏù¥ÏóàÏúºÎ©¥ Í∑∏Í±¥ Ï¢ÖÎ£å
    G.feverOn = false;
    // G.feverÎäî Ïú†ÏßÄÎê®!
    
    G.mistakes = 0;
    G.frozenTime = 0;
    G.lastTick = 0;
    itemHintShown = false;  // v7.3: ÌûåÌä∏ Ï¥àÍ∏∞Ìôî
    
    // ÏúÑÌóò Î™®Îìú Ï¥àÍ∏∞Ìôî
    $('dangerVignette').classList.remove('on', 'critical');
    $('heartbeatOverlay').classList.remove('on');
    document.body.classList.remove('danger-mode', 'critical-mode');
    $('timeAtmosphere').classList.remove('safe', 'caution', 'warning', 'danger', 'critical');
    $('freezeOverlay').classList.remove('on');
    $('itemHint').classList.remove('on');
    
    // ÌîºÎ≤Ñ Í¥ÄÎ†® Ï¥àÍ∏∞Ìôî
    stopStarRain();
    $('feverInvincible').classList.remove('on');
    
    $('feverBar').classList.remove('active');
    $('feverMode').classList.remove('on');
    $('megaTimer').classList.remove('frozen', 'warning', 'danger', 'critical');
    
    // v7.3: ÏãúÍ∞Ñ Î∞∏Îü∞Ïä§ - Î†àÎ≤®Ïóê Îî∞Îùº ÏãúÍ∞Ñ Ï¶ùÍ∞Ä (Ïπ¥ÎìúÎèÑ Ï¶ùÍ∞ÄÌïòÎãàÍπå)
    // Í∏∞Î≥∏ 12Ï¥à + Î†àÎ≤®Îãπ 1Ï¥à, ÏµúÎåÄ 20Ï¥à
    G.maxTime = Math.min(G.baseTime + Math.floor(G.level / 2), 20);
    G.time = G.maxTime;
    
    G.flipped = [];
    G.matched = 0;
    
    const pairs = Math.min(3 + Math.floor(G.level / 3), 15);
    G.total = pairs;
    $('levelSub').textContent = `Ïπ¥Îìú ${pairs}Ïåç`;
    
    for (let k in G.startItems) G.items[k] += G.startItems[k];
    
    // v7.3: Î†àÎ≤® 1 ÌîºÎ≤Ñ ÌäúÌÜ†Î¶¨Ïñº - 50%Î°ú ÏãúÏûë!
    if (G.level === 1 && G.fever === 0) {
        G.fever = 50;
        setTimeout(() => {
            toast('üí° ÌîºÎ≤Ñ Í≤åÏù¥ÏßÄÍ∞Ä Ï±ÑÏõåÏßÄÎ©¥ Î¨¥Ï†Å!');
        }, 2000);
    }
    
    createCards(pairs);
    ui();
    updateTimerDisplay();
    shuffleAnimation();
}

function shuffleAnimation() {
    const cards = document.querySelectorAll('.card');
    const grid = $('grid');
    const gridRect = grid.getBoundingClientRect();
    const centerX = gridRect.width / 2;
    const centerY = gridRect.height / 2;
    
    cards.forEach(card => {
        const cardRect = card.getBoundingClientRect();
        const cardCenterX = cardRect.left - gridRect.left + cardRect.width / 2;
        const cardCenterY = cardRect.top - gridRect.top + cardRect.height / 2;
        card.style.setProperty('--toX', `${centerX - cardCenterX}px`);
        card.style.setProperty('--toY', `${centerY - cardCenterY}px`);
    });
    
    audioManager.play('shuffle');
    cards.forEach(c => c.classList.add('flipped'));
    
    setTimeout(() => {
        audioManager.play('flip');
        cards.forEach(c => { c.classList.remove('flipped'); c.classList.add('shuffle-center'); });
    }, 500);
    
    setTimeout(() => {
        cards.forEach(c => { c.classList.remove('shuffle-center'); c.classList.add('shuffle-spin'); });
    }, 700);
    
    setTimeout(() => {
        audioManager.play('flip');
        cards.forEach(c => { c.classList.remove('shuffle-spin'); c.classList.add('shuffle-spread'); });
    }, 1000);
    
    setTimeout(() => {
        cards.forEach(c => {
            c.classList.remove('shuffle-spread');
            c.style.removeProperty('--toX');
            c.style.removeProperty('--toY');
        });
    }, 1200);
    
    setTimeout(() => {
        audioManager.play('letsgo');
        audioManager.playBGM('game');
        shake('hard');
        
        const goText = $('goText');
        goText.classList.add('show');
        setTimeout(() => goText.classList.remove('show'), 800);
        
        G.running = true;
        G.canFlip = true;
        ui();
        startTimer();
        
        if (G.autoMatch && G.items.gun > 0) {
            setTimeout(() => useItem('gun', true), 200);
        }
    }, 1300);
}

function createCards(pairs) {
    const sel = shuffled(EMOJIS).slice(0, pairs);
    const deck = shuffled([...sel, ...sel]);
    G.cards = deck.map((e, i) => ({ id: i, emoji: e, matched: false }));
    
    const cols = pairs <= 4 ? 4 : pairs <= 8 ? 4 : pairs <= 12 ? 5 : 6;
    const grid = $('grid');
    grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    grid.innerHTML = '';
    
    deck.forEach((e, i) => {
        const el = document.createElement('div');
        el.className = 'card';
        el.dataset.id = i;
        el.innerHTML = `<div class="face front">${e}</div><div class="face back">?</div>`;
        el.onclick = () => flip(i);
        grid.appendChild(el);
    });
}

// ===== Ïπ¥Îìú Îí§ÏßëÍ∏∞ =====
function flip(id) {
    if (!G.running || !G.canFlip) return;
    
    const card = G.cards[id];
    if (card.matched || G.flipped.includes(id) || G.flipped.length >= 2) return;
    
    audioManager.play('flip');
    document.querySelector(`.card[data-id="${id}"]`).classList.add('flipped');
    G.flipped.push(id);
    
    if (G.flipped.length === 2) {
        G.canFlip = false;
        setTimeout(checkMatch, 250);
    }
}

function checkMatch() {
    const [i1, i2] = G.flipped;
    const c1 = G.cards[i1], c2 = G.cards[i2];
    const el1 = document.querySelector(`.card[data-id="${i1}"]`);
    const el2 = document.querySelector(`.card[data-id="${i2}"]`);
    
    if (c1.emoji === c2.emoji) {
        // ‚ïê‚ïê‚ïê ‚úÖ Îß§Ïπ≠ ÏÑ±Í≥µ ‚ïê‚ïê‚ïê
        c1.matched = true;
        c2.matched = true;
        el1.classList.add('matched');
        el2.classList.add('matched');
        G.matched++;
        G.combo++;
        G.consecutiveMistakes = 0;  // Ïó∞ÏÜç Ïã§Ïàò Ï¥àÍ∏∞Ìôî
        if (G.combo > G.maxCombo) G.maxCombo = G.combo;
        
        const rect = el1.getBoundingClientRect();
        const isLevelClear = (G.matched >= G.total);
        
        if (!isLevelClear) {
            if (G.combo >= 3) {
                audioManager.play('combo');
                shake('hard');
            } else {
                audioManager.play('match');
                shake('normal');
            }
        } else {
            shake('hard');
        }
        
        particles(rect.left + rect.width/2, rect.top + rect.height/2, 8 + G.combo * 2);
        
        // üåü v7.2: ÌîºÎ≤Ñ ÏóêÎÑàÏßÄ ÎÇ†ÏïÑÍ∞ÄÎäî Ìö®Í≥º
        if (!G.feverOn && !isLevelClear) {
            shootFeverEnergy(rect.left + rect.width/2, rect.top + rect.height/2);
        }
        
        // ÏΩîÏù∏ Í≥ÑÏÇ∞ (ÌîºÎ≤Ñ 3Î∞∞!, Îü≠ÌÇ§ÌÉÄÏûÑ 2Î∞∞)
        let gain = 10 * (1 + G.combo * 0.1 * G.comboMult) * G.coinMult;
        if (G.feverOn) gain *= 3;  // ÌîºÎ≤Ñ Îïå 3Î∞∞!
        if (G.luckyTimeActive) gain *= 2;
        G.coins += Math.floor(gain);
        
        if (!isLevelClear) {
            showCoinPop('+' + Math.floor(gain), el1);
            audioManager.play('coin');
            
            // Îü≠ÌÇ§ ÌÉÄÏûÑ Ï≤¥ÌÅ¨
            checkLuckyTime();
        }
        
        addFever(12 * G.feverRate);
        
        if (!isLevelClear && Math.random() < G.dropRate) dropItem();
        
        G.flipped = [];
        G.canFlip = true;
        G.lastMatchedPairs = G.matched;
        
        if (isLevelClear) {
            levelClear();
            return;
        }
        checkBadges();
        
    } else {
        // ‚ïê‚ïê‚ïê ‚ùå Îß§Ïπ≠ Ïã§Ìå® ‚ïê‚ïê‚ïê
        
        // üõ°Ô∏è v7.2: ÌîºÎ≤Ñ Ï§ëÏù¥Î©¥ Î¨¥Ï†Å!
        if (G.feverOn) {
            // Î¨¥Ï†Å - ÌéòÎÑêÌã∞ ÏóÜÏùå, Îπ†Î•¥Í≤å Îã´Ìûò
            audioManager.play('wrong');
            el1.classList.add('wrong');
            el2.classList.add('wrong');
            
            toast('üõ°Ô∏è Î¨¥Ï†Å!');
            
            setTimeout(() => {
                el1.classList.remove('flipped', 'wrong');
                el2.classList.remove('flipped', 'wrong');
                G.flipped = [];
                G.canFlip = true;
            }, 150);  // ÌîºÎ≤Ñ Ï§ëÏóî Îçî Îπ†Î•¥Í≤å!
            
        } else {
            // ÏùºÎ∞ò ÏÉÅÌÉú: ÏÜêÏã§ ÌöåÌîº ÏãúÏä§ÌÖú
            const lostCombo = G.combo;
            G.consecutiveMistakes++;
            G.mistakes++;
            
            // ÏΩ§Î≥¥ ÎÅäÍπÄ ÏïÑÌîî
            if (lostCombo >= 3) {
                showComboBreak(lostCombo);
            }
            G.combo = 0;
            
            // ÏãúÍ∞Ñ Ï∞®Í∞ê (Ïâ¥Îìú Ï≤¥ÌÅ¨)
            if (G.hasShield && G.consecutiveMistakes === 1) {
                toast('üõ°Ô∏è Ïâ¥ÎìúÎ°ú ÎßâÏùå!');
                G.hasShield = false;
            } else {
                const penalty = Math.min(G.consecutiveMistakes, 5);  // ÏµúÎåÄ 5Ï¥à
                G.time = Math.max(0, G.time - penalty);
                showTimePenalty(penalty);
                
                // ÏÜêÏã§ ÏãúÍ∞ÅÌôî
                particles(window.innerWidth / 2, window.innerHeight / 2, 5, 'damage');
            }
            
            audioManager.play('wrong');
            shake('damage');
            
            el1.classList.add('wrong');
            el2.classList.add('wrong');
            
            setTimeout(() => {
                el1.classList.remove('flipped', 'wrong');
                el2.classList.remove('flipped', 'wrong');
                G.flipped = [];
                G.canFlip = true;
            }, 400);
        }
    }
    ui();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üé® v7.2: ÏãúÍ∞ÑÏóê Îî∞Î•∏ Î∞∞Í≤Ω Î∂ÑÏúÑÍ∏∞ Î≥ÄÌôî
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateTimeAtmosphere() {
    const pct = G.time / G.maxTime;
    const atm = $('timeAtmosphere');
    
    atm.classList.remove('safe', 'caution', 'warning', 'danger', 'critical');
    
    if (G.feverOn) {
        atm.classList.add('safe'); // ÌîºÎ≤Ñ Ï§ëÏóî ÏïàÏ†ÑÌïú ÎäêÎÇå
    } else if (pct > 0.5) {
        atm.classList.add('safe');
    } else if (pct > 0.25) {
        atm.classList.add('caution');
    } else if (pct > 0.15) {
        atm.classList.add('warning');
    } else if (pct > 0.08) {
        atm.classList.add('danger');
    } else {
        atm.classList.add('critical');
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üåü v7.2: ÌîºÎ≤Ñ ÏóêÎÑàÏßÄ ÎÇ†ÏïÑÍ∞ÄÎäî Ìö®Í≥º
// Ïã¨Î¶¨Ìïô: Ïù∏Í≥ºÍ¥ÄÍ≥ÑÏùò ÏãúÍ∞ÅÌôî - "ÎÇ¥Í∞Ä ÏûòÌï¥ÏÑú Ï†ÄÍ≤å Ï∞ºÎã§"
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function shootFeverEnergy(startX, startY) {
    const feverBar = $('feverBar');
    const barRect = feverBar.getBoundingClientRect();
    const endX = barRect.left + (G.fever / 100) * barRect.width;
    const endY = barRect.top + barRect.height / 2;
    
    const star = document.createElement('div');
    star.className = 'fever-energy';
    star.textContent = '‚≠ê';
    star.style.left = startX + 'px';
    star.style.top = startY + 'px';
    
    document.body.appendChild(star);
    
    // Ïï†ÎãàÎ©îÏù¥ÏÖòÏúºÎ°ú ÌîºÎ≤ÑÎ∞îÍπåÏßÄ Ïù¥Îèô
    const duration = 400;
    const startTime = performance.now();
    
    function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Ïù¥Ïßï Ìï®Ïàò (ease-out)
        const eased = 1 - Math.pow(1 - progress, 3);
        
        const currentX = startX + (endX - startX) * eased;
        const currentY = startY + (endY - startY) * eased;
        
        star.style.left = currentX + 'px';
        star.style.top = currentY + 'px';
        star.style.transform = `scale(${1 - progress * 0.5}) rotate(${progress * 360}deg)`;
        
        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            star.remove();
            // ÌîºÎ≤ÑÎ∞î Î∞òÏßùÏûÑ
            feverBar.style.filter = 'brightness(2)';
            setTimeout(() => feverBar.style.filter = '', 100);
        }
    }
    
    requestAnimationFrame(animate);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üåü v7.2: ÌîºÎ≤ÑÌÉÄÏûÑ Î≥Ñ ÎπÑ Ìö®Í≥º
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let starRainInterval = null;

function startStarRain() {
    const nightclub = $('feverNightclub');
    nightclub.classList.add('on');
    
    const stars = ['‚≠ê', 'üåü', '‚ú®', 'üí´', 'üî•', 'üíé'];
    
    starRainInterval = setInterval(() => {
        const star = document.createElement('div');
        star.className = 'star-rain';
        star.textContent = stars[Math.floor(Math.random() * stars.length)];
        star.style.left = Math.random() * 100 + '%';
        star.style.animationDuration = (1 + Math.random() * 2) + 's';
        star.style.fontSize = (15 + Math.random() * 20) + 'px';
        nightclub.appendChild(star);
        
        setTimeout(() => star.remove(), 3000);
    }, 100);
}

function stopStarRain() {
    if (starRainInterval) {
        clearInterval(starRainInterval);
        starRainInterval = null;
    }
    $('feverNightclub').classList.remove('on');
    $('feverNightclub').innerHTML = '';
}

// ===== ÌîºÎ≤Ñ =====
function addFever(amt) {
    if (G.feverOn) return;
    
    // v7.3: ÏΩ§Î≥¥ Î≥¥ÎÑàÏä§Î°ú Ï∂©Ï†Ñ ÏÜçÎèÑ Ï¶ùÍ∞Ä!
    const comboBonus = 1 + G.combo * 0.1;
    const totalAmt = amt * comboBonus;
    
    G.fever = Math.min(100, G.fever + totalAmt);
    if (G.fever >= 100) activateFever();
    ui();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üî• v7.2: ÌîºÎ≤ÑÌÉÄÏûÑ = Î¨¥Ï†Å + ÎÇòÏù¥Ìä∏ÌÅ¥ÎüΩ
// Ïã¨Î¶¨Ìïô: Í∏¥Ïû• ‚Üí Ìï¥Î∞© ‚Üí Îã§Ïãú Í∏¥Ïû•Ïùò ÏÇ¨Ïù¥ÌÅ¥Ïù¥ Ï§ëÎèÖÏùÑ ÎßåÎì¶
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function activateFever() {
    G.feverOn = true;
    G.gotFever = true;
    
    // UI ÏóÖÎç∞Ïù¥Ìä∏
    $('feverBar').classList.add('active');
    $('feverMode').classList.add('on');
    $('feverInvincible').classList.add('on');
    
    // ÎÇòÏù¥Ìä∏ÌÅ¥ÎüΩ Ìö®Í≥º ÏãúÏûë
    startStarRain();
    
    // ÏÇ¨Ïö¥Îìú & Ïù¥ÌéôÌä∏
    audioManager.playBGM('fever');
    shake('hard');
    vibrate([100, 50, 100, 50, 100]);
    
    // ÌôîÎ©¥ Ï§ëÏïôÏóê ÌÅ∞ ÌÖçÏä§Ìä∏
    const overlay = document.createElement('div');
    overlay.style.cssText = `
        position: fixed; inset: 0; z-index: 1000;
        display: flex; align-items: center; justify-content: center;
        pointer-events: none;
    `;
    overlay.innerHTML = `
        <div style="
            font-size: 48px; font-weight: 900;
            background: linear-gradient(135deg, #ff0080, #ffd700, #00ffff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: feverTextPop 0.8s ease forwards;
        ">üî• FEVER TIME! üî•</div>
    `;
    document.body.appendChild(overlay);
    
    // Ïä§ÌÉÄÏùº Ï∂îÍ∞Ä
    if (!document.getElementById('feverTextStyle')) {
        const style = document.createElement('style');
        style.id = 'feverTextStyle';
        style.textContent = `
            @keyframes feverTextPop {
                0% { transform: scale(0); opacity: 0; }
                50% { transform: scale(1.3); opacity: 1; }
                100% { transform: scale(1) translateY(-50px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }
    
    setTimeout(() => overlay.remove(), 800);
    
    toast('üî• Î¨¥Ï†Å! 5Ï¥àÍ∞Ñ ÎßàÏùåÍªè!');
    
    // 5Ï¥à ÌõÑ ÌîºÎ≤Ñ Ï¢ÖÎ£å
    setTimeout(() => {
        G.feverOn = false;
        G.fever = 0;
        
        $('feverBar').classList.remove('active');
        $('feverMode').classList.remove('on');
        $('feverInvincible').classList.remove('on');
        
        stopStarRain();
        
        if (G.running) {
            audioManager.playBGM('game');
            toast('üíî ÌîºÎ≤Ñ Ï¢ÖÎ£å... Îã§Ïãú Ï°∞Ïã¨!');
            shake('normal');
        }
        ui();
    }, 5000);  // 5Ï¥àÎ°ú Îã®Ï∂ïÌïòÏßÄÎßå Îçî Í∞ïÎ†¨ÌïòÍ≤å
}

// ===== ÌÉÄÏù¥Î®∏ =====
function startTimer() {
    if (G.timer) clearInterval(G.timer);
    
    G.timer = setInterval(() => {
        if (!G.running) return;
        
        if (G.frozenTime > 0) {
            G.frozenTime -= 0.1;
            if (G.frozenTime <= 0) {
                G.frozenTime = 0;
                $('megaTimer').classList.remove('frozen');
                $('freezeOverlay').classList.remove('on');
            }
        } else {
            G.time -= 0.1;
        }
        
        updateTimerDisplay();
        updateTimeAtmosphere();  // üé® Î∞∞Í≤ΩÏÉâ Î≥ÄÌôî
        
        // v7.3: ÏïÑÏù¥ÌÖú ÌûåÌä∏ ÎßêÌíçÏÑ†
        showItemHint();
        
        // BGM ÏÜçÎèÑ Ï°∞Ï†à
        const pct = G.time / G.maxTime;
        if (pct <= 0.15) audioManager.setSpeed(1.4);
        else if (pct <= 0.25) audioManager.setSpeed(1.3);
        else if (pct <= 0.5) audioManager.setSpeed(1.15);
        else audioManager.setSpeed(1.0);
        
        if (G.time <= 0) {
            G.time = 0;
            updateTimerDisplay();
            gameOver();
        }
    }, 100);
}

// v7.3: ÏïÑÏù¥ÌÖú ÌûåÌä∏ ÎßêÌíçÏÑ†
let itemHintShown = false;
function showItemHint() {
    const hint = $('itemHint');
    
    // Ïù¥ÎØ∏ Î≥¥Ïó¨Ï§¨ÏúºÎ©¥ Ìå®Ïä§
    if (itemHintShown) {
        hint.classList.remove('on');
        return;
    }
    
    // ÏãúÍ∞Ñ 5Ï¥à Ïù¥Ìïò + ÏïÑÏù¥ÌÖú ÏûàÏùå
    if (G.time <= 5 && G.time > 0 && !G.feverOn) {
        if (G.items.freeze > 0) {
            hint.textContent = '‚ùÑÔ∏è ÌîÑÎ¶¨Ï¶àÎ°ú ÏãúÍ∞ÑÏùÑ Î©àÏ∂∞!';
            hint.classList.add('on');
        } else if (G.items.time > 0) {
            hint.textContent = '‚è∞ ÏãúÍ∞Ñ Ï∂îÍ∞Ä ÏïÑÏù¥ÌÖú ÏÇ¨Ïö©!';
            hint.classList.add('on');
        } else if (G.items.gun > 0) {
            hint.textContent = 'üî´ Ï¥ùÏúºÎ°ú Ïπ¥Îìú ÌååÍ¥¥!';
            hint.classList.add('on');
        } else if (G.items.hint > 0) {
            hint.textContent = 'üí° ÌûåÌä∏Î°ú ÏúÑÏπò ÌôïÏù∏!';
            hint.classList.add('on');
        }
        itemHintShown = true;
        setTimeout(() => hint.classList.remove('on'), 3000);
    }
}

// ===== Î†àÎ≤® ÌÅ¥Î¶¨Ïñ¥ =====
function levelClear() {
    // Ïù¥Ï§ë Ìò∏Ï∂ú Î∞©ÏßÄ
    if (!G.running) return;
    
    G.running = false;
    G.canFlip = false;
    
    // ÌÉÄÏù¥Î®∏ Ï¶âÏãú Ï†ïÏßÄ (race condition Î∞©ÏßÄ)
    if (G.timer) {
        clearInterval(G.timer);
        G.timer = null;
    }
    
    audioManager.stopAllSFX();
    audioManager.play('pop');
    audioManager.setSpeed(1.0);
    
    // ÏúÑÌóò Î™®Îìú Ìï¥Ï†ú
    $('dangerVignette').classList.remove('on', 'critical');
    $('heartbeatOverlay').classList.remove('on');
    document.body.classList.remove('danger-mode', 'critical-mode');
    $('timeAtmosphere').classList.remove('safe', 'caution', 'warning', 'danger', 'critical');
    
    // ÌîºÎ≤Ñ Í¥ÄÎ†® Ï†ïÎ¶¨
    stopStarRain();
    $('feverInvincible').classList.remove('on');
    
    if (G.time >= 10) G.gotSpeed = true;
    if (G.mistakes === 0) G.gotPerfect = true;
    
    // ÏµúÍ≥† Í∏∞Î°ù ÏóÖÎç∞Ïù¥Ìä∏
    if (G.level > SaveData.bestLevel) {
        SaveData.bestLevel = G.level;
        toast('üèÜ Ïã†Í∏∞Î°ù! Lv.' + G.level);
    }
    if (G.maxCombo > SaveData.bestCombo) {
        SaveData.bestCombo = G.maxCombo;
    }
    SaveData.save();
    
    checkBadges();
    
    const bonus = G.level * 20 + Math.floor(G.time) * 3;
    G.coins += bonus;
    toast(`+${bonus}ü™ô ÌÅ¥Î¶¨Ïñ¥ Î≥¥ÎÑàÏä§!`);
    shake('hard');
    
    setTimeout(() => {
        if (G.level % 5 === 0) {
            G.gotBonus = true;
            showBonus();
        } else {
            showPerks();
        }
    }, 600);
}

// ===== ÌçΩ ÏÑ†ÌÉù =====
let perkTimer = null;
let perkCountdownInterval = null;

function showPerks() {
    const list = $('perkList');
    list.innerHTML = '';
    const perks = shuffled(PERKS).slice(0, 3);
    
    perks.forEach(p => {
        const div = document.createElement('div');
        div.className = 'perk';
        div.innerHTML = `<div class="perk-icon">${p.icon}</div><div class="perk-name">${p.name}</div><div class="perk-desc">${p.desc}</div>`;
        div.onclick = () => selectPerk(p);
        list.appendChild(div);
    });
    
    // ÌÉÄÏù¥Î®∏ UI Ï¥àÍ∏∞Ìôî
    let timeLeft = 5;
    $('perkCountdown').textContent = timeLeft;
    $('perkTimerBar').style.width = '100%';
    
    $('scrPerk').classList.add('on');
    
    // ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
    if (perkTimer) clearTimeout(perkTimer);
    if (perkCountdownInterval) clearInterval(perkCountdownInterval);
    
    // Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ UI ÏóÖÎç∞Ïù¥Ìä∏ (100msÎßàÎã§)
    let elapsed = 0;
    perkCountdownInterval = setInterval(() => {
        elapsed += 100;
        const remaining = 5 - (elapsed / 1000);
        $('perkTimerBar').style.width = (remaining / 5 * 100) + '%';
        $('perkCountdown').textContent = Math.ceil(remaining);
        
        if (remaining <= 2) {
            $('perkCountdown').style.color = '#ff3b30';
        } else {
            $('perkCountdown').style.color = 'var(--gold)';
        }
    }, 100);
    
    // 5Ï¥à ÌõÑ ÏûêÎèô ÏÑ†ÌÉù
    perkTimer = setTimeout(() => {
        if ($('scrPerk').classList.contains('on')) {
            selectPerk(perks[0]);
            toast('‚è∞ ÏûêÎèô ÏÑ†ÌÉù!');
        }
    }, 5000);
}

function selectPerk(p) {
    if (perkTimer) clearTimeout(perkTimer);
    if (perkCountdownInterval) clearInterval(perkCountdownInterval);
    p.fn();
    G.perkCnt++;
    checkBadges();
    $('scrPerk').classList.remove('on');
    audioManager.play('coin');
    G.level++;
    initLevel();
}

// ===== Î≥¥ÎÑàÏä§ =====
function showBonus() {
    $('slot0').textContent = '?';
    $('slot1').textContent = '?';
    $('slot2').textContent = '?';
    $('btnSpin').disabled = false;
    $('scrBonus').classList.add('on');
}

function spinSlot() {
    $('btnSpin').disabled = true;
    const syms = ['üçí','üçã','üçä','‚≠ê','üíé','7Ô∏è‚É£'];
    const slots = [$('slot0'), $('slot1'), $('slot2')];
    const results = [];
    
    slots.forEach(s => s.classList.add('spin'));
    audioManager.play('spin');
    
    slots.forEach((s, i) => {
        setTimeout(() => {
            s.classList.remove('spin');
            const sym = syms[Math.floor(Math.random() * syms.length)];
            s.textContent = sym;
            results.push(sym);
            audioManager.play('flip');
            
            if (results.length === 3) {
                setTimeout(() => {
                    let reward = 100;
                    if (results[0] === results[1] && results[1] === results[2]) {
                        reward = results[0] === '7Ô∏è‚É£' ? 2000 : results[0] === 'üíé' ? 1500 : 800;
                        toast(`üéâ Ïû≠Ìåü! +${reward}ü™ô`);
                        audioManager.play('win');
                        shake('hard');
                    } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
                        reward = 300;
                        toast(`üëç +${reward}ü™ô`);
                        audioManager.play('coin');
                    } else {
                        toast(`+${reward}ü™ô`);
                        audioManager.play('coin');
                    }
                    G.coins += reward;
                    ui();
                    
                    setTimeout(() => {
                        $('scrBonus').classList.remove('on');
                        showPerks();
                    }, 800);
                }, 300);
            }
        }, 400 + i * 350);
    });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üíÄ v7: Í≤åÏûÑÏò§Î≤Ñ - Near Miss Í∞ïÏ°∞
// Ïã¨Î¶¨Ìïô: "Í±∞Ïùò ÏÑ±Í≥µ"ÏùÄ Ïã§Ï†ú ÏÑ±Í≥µÎ≥¥Îã§ Îçî Í∞ïÌïú Ïû¨ÎèÑÏ†Ñ ÏöïÍµ¨Î•º Ïú†Î∞ú
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gameOver() {
    // Ïù¥Ï§ë Ìò∏Ï∂ú Î∞©ÏßÄ
    if (!G.running) return;
    
    G.running = false;
    G.canFlip = false;
    
    // ÌÉÄÏù¥Î®∏ Ï¶âÏãú Ï†ïÏßÄ
    if (G.timer) {
        clearInterval(G.timer);
        G.timer = null;
    }
    
    audioManager.stopAllSFX();
    audioManager.stopBGM();
    audioManager.play('fail');
    shake('damage');
    
    // ÏúÑÌóò Î™®Îìú Ìï¥Ï†ú
    $('dangerVignette').classList.remove('on', 'critical');
    $('heartbeatOverlay').classList.remove('on');
    document.body.classList.remove('danger-mode', 'critical-mode');
    $('timeAtmosphere').classList.remove('safe', 'caution', 'warning', 'danger', 'critical');
    $('freezeOverlay').classList.remove('on');
    
    // ÌîºÎ≤Ñ Í¥ÄÎ†® Ï†ïÎ¶¨
    stopStarRain();
    $('feverInvincible').classList.remove('on');
    
    // Near Miss Í≥ÑÏÇ∞
    const remainingPairs = G.total - G.matched;
    const nearMissDiv = $('nearMiss');
    
    if (remainingPairs <= 3 && remainingPairs > 0) {
        nearMissDiv.style.display = 'block';
        $('nearMissText').textContent = `üò± ${remainingPairs}ÏåçÎßå Îçî ÎßûÏ∂îÎ©¥ ÎêêÎäîÎç∞!`;
        const avgTime = (remainingPairs * 1.8 + Math.random() * 0.5).toFixed(1);
        $('nearMissDetail').textContent = `${avgTime}Ï¥àÎßå Îçî ÏûàÏóàÎã§Î©¥...`;
        $('nearMissCompare').textContent = `üìä ÎèÑÌååÎß§Ïπò ÌèâÍ∑†: ${avgTime}Ï¥àÎ©¥ ${remainingPairs}Ïåç ÌÅ¥Î¶¨Ïñ¥`;
    } else {
        nearMissDiv.style.display = 'none';
    }
    
    $('finalCoin').textContent = G.coins.toLocaleString();
    $('finalLv').textContent = G.level;
    $('finalCombo').textContent = G.maxCombo;
    $('finalBadge').textContent = Object.keys(G.badges).length;
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // v7.3: Í∞ÄÏßú Í∏ÄÎ°úÎ≤å ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
    // Ïã¨Î¶¨Ìïô: ÌÅ∞ Ïà´Ïûê = Í∂åÏúÑ, Í≤ΩÏüÅÏã¨ Ïú†Î∞ú
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const totalUsers = 1593847;
    const levelPassRates = {
        1: 0.85, 2: 0.72, 3: 0.58, 4: 0.45, 5: 0.33,
        6: 0.24, 7: 0.17, 8: 0.11, 9: 0.07, 10: 0.045,
        15: 0.015, 20: 0.005, 25: 0.001
    };
    
    let passRate = levelPassRates[G.level] || Math.max(0.0001, 0.5 / G.level);
    const passCount = Math.floor(totalUsers * passRate);
    const passPct = (passRate * 100).toFixed(1);
    
    $('passLevel').textContent = G.level;
    $('passCount').textContent = passCount.toLocaleString();
    $('passPct').textContent = passPct + '%';
    $('yourRank').textContent = `ÏÉÅÏúÑ ${passPct}%`;
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // v7.3: Îä•Î†• Î∂ÑÏÑù (Í∞ÄÏßúÏßÄÎßå Í∑∏Îü¥ÎìØÌïòÍ≤å)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const memoryScore = Math.min(95, 30 + G.level * 5 + G.maxCombo * 3 + Math.random() * 10);
    const speedScore = Math.min(90, 20 + G.level * 4 + (G.mistakes < 3 ? 20 : 0) + Math.random() * 15);
    const focusScore = Math.min(85, 25 + G.maxCombo * 8 + Math.random() * 10);
    
    $('memoryBar').style.width = memoryScore + '%';
    $('speedBar').style.width = speedScore + '%';
    $('focusBar').style.width = focusScore + '%';
    
    $('memoryPct').textContent = `ÏÉÅÏúÑ ${(100 - memoryScore).toFixed(0)}%`;
    $('speedPct').textContent = `ÏÉÅÏúÑ ${(100 - speedScore).toFixed(0)}%`;
    $('focusPct').textContent = `ÏÉÅÏúÑ ${(100 - focusScore).toFixed(0)}%`;
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // v7.3: Ïò§ÎäòÏùò Î±ÉÏßÄ (ÌîåÎ†àÏù¥ Ïä§ÌÉÄÏùºÏóê Îî∞Îùº)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const todayBadges = [
        { icon: 'üî•', name: 'Í∑ºÏÑ±Í∞ÄÏù¥', desc: 'ÎÅùÍπåÏßÄ Ìè¨Í∏∞ÌïòÏßÄ ÏïäÏùå', cond: () => G.level >= 3 },
        { icon: '‚ö°', name: 'Î≤àÍ∞úÏÜê', desc: 'Îπ†Î•∏ Î∞òÏùëÏÜçÎèÑ Î∞úÌúò', cond: () => G.maxCombo >= 4 },
        { icon: 'üß†', name: 'Í∏∞ÏñµÏôï', desc: 'Îõ∞Ïñ¥ÎÇú Í∏∞ÏñµÎ†• Î≥¥Ïú†', cond: () => G.mistakes <= 2 },
        { icon: 'üí∞', name: 'Ìô©Í∏àÏÜê', desc: 'ÏΩîÏù∏ ÏàòÏßëÏùò Îã¨Ïù∏', cond: () => G.coins >= 500 },
        { icon: 'üéØ', name: 'ÏßëÏ§ëÎ†•Áî≤', desc: 'ÌùîÎì§Î¶¨ÏßÄ ÏïäÎäî ÏßëÏ§ë', cond: () => G.level >= 5 },
        { icon: 'üåü', name: 'Ïã†Ïù∏Ïôï', desc: 'Ïû†Ïû¨Î†•Ïù¥ Î≥¥Ïù∏Îã§', cond: () => true },
    ];
    
    const earnedBadge = todayBadges.find(b => b.cond()) || todayBadges[todayBadges.length - 1];
    $('todayBadgeIcon').textContent = earnedBadge.icon;
    $('todayBadgeName').textContent = earnedBadge.name;
    $('todayBadgeDesc').textContent = earnedBadge.desc;
    
    $('btnRevive').style.display = G.hasRevive ? 'block' : 'none';
    
    // ÏµúÍ≥† Í∏∞Î°ù Ï†ÄÏû•
    SaveData.totalCoins += G.coins;
    SaveData.save();
    
    checkBadges();
    $('scrOver').classList.add('on');
}

// v7.3: Ìè¨Í∏∞ Ìï®Ïàò
function giveUp() {
    $('scrOver').classList.remove('on');
    $('scrStart').classList.add('on');
    audioManager.playBGM('intro');
    initStartScreen();
}

// v7.3: Í≤åÏûÑÏò§Î≤ÑÏóêÏÑú Î±ÉÏßÄ Î≥¥Í∏∞
function showBadgesFromGameOver() {
    $('scrOver').classList.remove('on');
    showBadges();
}

// Î±ÉÏßÄ Îã´ÏùÑ Îïå Í≤åÏûÑÏò§Î≤ÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ (Í≤åÏûÑ Ï§ëÏù¥ ÏïÑÎãê Îïå)
function closeBadgesAndReturn() {
    $('scrBadge').classList.remove('on');
    if (!G.running && G.level > 1) {
        $('scrOver').classList.add('on');
    }
}

function revive() {
    G.hasRevive = false;
    G.time = 8;  // v7.3: 8Ï¥à (Í∏∞Î≥∏ ÏãúÍ∞ÑÏù¥ ÏßßÏïÑÏ°åÏúºÎØÄÎ°ú)
    G.running = true;
    G.canFlip = true;
    G.consecutiveMistakes = 0;
    itemHintShown = false;
    $('scrOver').classList.remove('on');
    audioManager.playBGM('game');
    audioManager.setSpeed(1.2);
    startTimer();
    toast('‚ù§Ô∏è Î∂ÄÌôú! 8Ï¥à Ï∂îÍ∞Ä!');
    ui();
}

function restart() {
    G.level = 1;
    G.coins = 0;
    G.combo = 0;
    G.maxCombo = 0;
    G.fever = 0;  // v7.3: ÌîºÎ≤Ñ Ï¥àÍ∏∞Ìôî
    G.baseTime = 12;  // v7.3: Í∑πÎã®Ï†Å ÏãúÍ∞Ñ!
    G.feverRate = 1;
    G.coinMult = 1;
    G.comboMult = 1;
    G.dropRate = 0.25;
    G.startItems = { gun: 0, time: 0, hint: 0, freeze: 0 };
    G.autoMatch = false;
    G.hasShield = false;
    G.items = { gun: 1, time: 2, hint: 2, freeze: 1 };
    G.bought = { gun: 0, time: 0, hint: 0, freeze: 0 };
    G.hasRevive = true;
    G.perkCnt = 0;
    G.gotFever = false;
    G.gotBonus = false;
    G.gotSpeed = false;
    G.gotPerfect = false;
    G.mistakes = 0;
    G.consecutiveMistakes = 0;
    G.luckyTimeActive = false;
    itemHintShown = false;  // v7.3: ÌûåÌä∏ Ï¥àÍ∏∞Ìôî
    
    $('luckyIndicator').classList.remove('on');
    $('scrOver').classList.remove('on');
    initLevel();
}

// ===== ÏïÑÏù¥ÌÖú =====
function useItem(type, auto = false) {
    if (!G.running && !auto) return;
    if (G.items[type] <= 0) return;
    G.items[type]--;
    
    if (type === 'gun') {
        audioManager.play('gun');
        shake('hard');
        const un = G.cards.filter(c => !c.matched);
        if (un.length >= 2) {
            const t = un[0];
            const p = un.find(c => c.emoji === t.emoji && c.id !== t.id);
            if (p) {
                const el1 = document.querySelector(`.card[data-id="${t.id}"]`);
                const el2 = document.querySelector(`.card[data-id="${p.id}"]`);
                el1.classList.add('flipped', 'matched');
                el2.classList.add('flipped', 'matched');
                t.matched = true;
                p.matched = true;
                G.matched++;
                
                const rect = el1.getBoundingClientRect();
                particles(rect.left + rect.width/2, rect.top + rect.height/2, 15);
                
                if (G.matched >= G.total) {
                    setTimeout(() => levelClear(), 300);
                }
            }
        }
    } else if (type === 'time') {
        audioManager.play('time');
        G.time = Math.min(G.maxTime, G.time + 10);
        toast('‚è∞ +10Ï¥à!');
        particles(window.innerWidth/2, 150, 10);
    } else if (type === 'hint') {
        audioManager.play('hint');
        const un = G.cards.filter(c => !c.matched);
        if (un.length >= 2) {
            const t = un[0];
            const p = un.find(c => c.emoji === t.emoji && c.id !== t.id);
            if (p) {
                [t.id, p.id].forEach(id => {
                    const el = document.querySelector(`.card[data-id="${id}"]`);
                    el.classList.add('flipped', 'hint');
                    setTimeout(() => {
                        if (!G.cards[id].matched) el.classList.remove('flipped');
                        el.classList.remove('hint');
                    }, 1200);
                });
            }
        }
        toast('üí° ÌûåÌä∏!');
    } else if (type === 'freeze') {
        audioManager.play('freeze');
        G.frozenTime = 5;
        $('megaTimer').classList.add('frozen');
        $('freezeOverlay').classList.add('on');  // v7.3: ÌååÎûÄÏÉâ ÌôîÎ©¥!
        particles(window.innerWidth/2, window.innerHeight/2, 15);
        toast('‚ùÑÔ∏è 5Ï¥à Ï†ïÏßÄ!');
        
        // 5Ï¥à ÌõÑ ÌååÎûÄÏÉâ Ìï¥Ï†ú
        setTimeout(() => {
            $('freezeOverlay').classList.remove('on');
        }, 5000);
    }
    ui();
}

function dropItem() {
    const types = ['time','hint','time','hint','gun','freeze'];
    const t = types[Math.floor(Math.random() * types.length)];
    G.items[t]++;
    const icons = { gun:'üî´', time:'‚è∞', hint:'üí°', freeze:'‚ùÑÔ∏è' };
    toast(`+${icons[t]} ÏïÑÏù¥ÌÖú ÌöçÎìù!`);
    audioManager.play('item');
    ui();
}

// ===== ÏÉÅÏ†ê =====
function showShop() {
    $('shopCoin').textContent = G.coins.toLocaleString();
    const items = [
        { id: 'gun', emoji: 'üî´', name: 'Ïπ¥Îìú ÌååÍ¥¥' },
        { id: 'time', emoji: '‚è∞', name: '+10Ï¥à' },
        { id: 'hint', emoji: 'üí°', name: 'ÌûåÌä∏' },
        { id: 'freeze', emoji: '‚ùÑÔ∏è', name: 'ÏãúÍ∞Ñ Ï†ïÏßÄ' },
    ];
    
    let html = '';
    items.forEach(it => {
        const price = Math.floor(G.prices[it.id] * Math.pow(1.15, G.bought[it.id]));
        const canBuy = G.coins >= price;
        html += `<div class="shop-item ${canBuy ? '' : 'off'}" onclick="buyItem('${it.id}', ${price})">
            <div class="shop-emoji">${it.emoji}</div>
            <div class="shop-name">${it.name}</div>
            <div class="shop-price">ü™ô ${price}</div>
            <div class="shop-own">Î≥¥Ïú†: ${G.items[it.id]}Í∞ú</div>
        </div>`;
    });
    $('shopGrid').innerHTML = html;
    $('scrShop').classList.add('on');
}

function buyItem(id, price) {
    if (G.coins < price) return;
    G.coins -= price;
    G.items[id]++;
    G.bought[id]++;
    G.shopCnt++;
    audioManager.play('coin');
    toast('‚úÖ Íµ¨Îß§ ÏôÑÎ£å!');
    checkBadges();
    showShop();
    ui();
}

function closeShop() { $('scrShop').classList.remove('on'); }

// ===== ÏÑ§Ï†ï =====
function showSettings() { $('scrSettings').classList.add('on'); }
function closeSettings() { $('scrSettings').classList.remove('on'); }

function toggleSound() {
    Settings.sound = !Settings.sound;
    audioManager.enabled = Settings.sound;
    $('toggleSound').textContent = Settings.sound ? 'ON' : 'OFF';
    $('toggleSound').classList.toggle('off', !Settings.sound);
    if (!Settings.sound) audioManager.stopBGM();
}

function toggleVibration() {
    Settings.vibration = !Settings.vibration;
    $('toggleVibration').textContent = Settings.vibration ? 'ON' : 'OFF';
    $('toggleVibration').classList.toggle('off', !Settings.vibration);
}

// ===== Î±ÉÏßÄ =====
function showBadges() {
    let html = '';
    BADGES.forEach(b => {
        const got = G.badges[b.id];
        html += `<div class="badge ${got ? 'got' : 'locked'}">
            <div class="badge-icon">${got ? b.icon : 'üîí'}</div>
            <div class="badge-name">${got ? b.name : '???'}</div>
        </div>`;
    });
    $('badgeGrid').innerHTML = html;
    $('scrBadge').classList.add('on');
}

function closeBadges() { 
    $('scrBadge').classList.remove('on'); 
    // Í≤åÏûÑÏò§Î≤Ñ ÏÉÅÌÉúÏòÄÏúºÎ©¥ Îã§Ïãú Í≤åÏûÑÏò§Î≤Ñ ÌôîÎ©¥ÏúºÎ°ú
    if (!G.running && G.level > 1 && !$('scrStart').classList.contains('on')) {
        $('scrOver').classList.add('on');
    }
}

function checkBadges() {
    BADGES.forEach(b => {
        if (!G.badges[b.id] && b.ck()) {
            G.badges[b.id] = true;
            setTimeout(() => toast(`üèÜ ${b.name} Î±ÉÏßÄ ÌöçÎìù!`), 300);
        }
    });
    ui();
}

// ===== Ïú†Ìã∏ =====
function toast(msg) {
    const t = document.createElement('div');
    t.className = 'toast';
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 1500);
}

function showCoinPop(txt, el) {
    const p = document.createElement('div');
    p.className = 'coin-pop';
    p.textContent = txt;
    if (el) {
        const r = el.getBoundingClientRect();
        p.style.left = r.left + r.width/2 + 'px';
        p.style.top = r.top + 'px';
    }
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 600);
}

// ===== Ï¥àÍ∏∞Ìôî =====
initFeed();
initStartScreen();
ui();

document.addEventListener('DOMContentLoaded', () => {
    audioManager.init();
});
</script>
</body>
</html>
